 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 1 - 09/30/24 17:27:32


       1/       0 :                     ; Netronic TinyBasic For The ELF II Recreation
       2/       0 :                     ; By Richard Peters, Richard11092000@cox.net
       3/       0 :                     ; Special THANKS to TOM PITTMAN for Writing Program,
       4/       0 :                     ; To LEE A. HART for Posting Necessary Parts
       5/       0 :                     ; And To Dave Ruske for creating COMACELF group
       6/       0 :                     ; Which Made This Recreation Possible
       7/       0 :                     ; Assembled With QELFEXE V2.0 Multiformat Assembler
       8/       0 :                     ; Current Code Running In Tinybasi.zip Emulator
       9/       0 :                     ; Requires Giant Board And ROM Monitor
      10/       0 :                     ; To Use LOAD And SAVE to Tape
      11/       0 :                     ; Designed to run In RAM Starting at 0000
      12/       0 :                     ; I Have Done What I Could To Make This Source
      13/       0 :                     ; Moveable And To Follow Itself, But I Still Could
      14/       0 :                     ; Could Have Missed Something. I Also Tried To Figure
      15/       0 :                     ; Out Some Of The IL Code and Add Comments To It.
      16/       0 :                     ; If There Is Something To Add Or Change, Let Me Know.
      17/       0 :                     ; Code Has Only Been Verified With What I Have
      18/       0 :                     ; Hope The Above Changes Soon.
      19/       0 :                     ; Last Update 01/29/2004 09:40PM
      20/       0 :                     ;
      21/       0 :                     ; INTERNAL MACRO DEFINITIONS
      22/       0 :                     ;
      23/       0 :                     ; CALL   = SEP R4 + DW   SUB LOCATION
      24/       0 :                     ; RETURN = SEP R5
      25/       0 :                     ; SEP R7 = SEP R7 + DB   LOW LOCATION OF BYTE
      26/       0 :                     ;
      27/       0 :                     
      28/       0 :                     FETCH  MACRO address
      29/       0 :                             SEP R7
      30/       0 :                     	db (address)&255
      31/       0 :                             ENDM
      32/       0 :                             
      33/       0 :                     CALL    MACRO address
      34/       0 :                             SEP R4
      35/       0 :                     	dw address
      36/       0 :                             ENDM
      37/       0 :                     
      38/       0 :                     RETURN  MACRO
      39/       0 :                             SEP R5
      40/       0 :                             ENDM
      41/       0 :                     
      42/       0 :                     SERIAL_B MACRO address
      43/       0 :                     		B4 address
      44/       0 :                     		ENDM
      45/       0 :                     
      46/       0 :                     SERIAL_BN MACRO address
      47/       0 :                     		BN4 address
      48/       0 :                     		ENDM
      49/       0 :                     		
      50/       0 :                     KB_B MACRO address
      51/       0 :                     		B3 address
      52/       0 :                     		ENDM
      53/       0 :                     
      54/       0 :                     KB_BN MACRO address
      55/       0 :                     		BN3 address
      56/       0 :                     		ENDM
      57/       0 :                     
      58/       0 :                     KB_INP MACRO address
      59/       0 :                     		INP   7
      60/       0 :                     		ENDM
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 2 - 09/30/24 17:27:32


      61/       0 :                     
      62/       0 :                     LDI0 MACRO
      63/       0 :                             GHI RD 
      64/       0 :                             ENDM
      65/       0 :                     
      66/       0 :                     
      67/       0 : =0H                 R0         EQU     0         ;REGISTER DEFINITION
      68/       0 : =1H                 R1         EQU     1         ;REGISTER DEFINITION
      69/       0 : =2H                 R2         EQU     2         ;REGISTER DEFINITION
      70/       0 : =3H                 R3         EQU     3         ;REGISTER DEFINITION
      71/       0 : =4H                 R4         EQU     4         ;REGISTER DEFINITION
      72/       0 : =5H                 R5         EQU     5         ;REGISTER DEFINITION
      73/       0 : =6H                 R6         EQU     6         ;REGISTER DEFINITION
      74/       0 : =7H                 R7         EQU     7         ;REGISTER DEFINITION
      75/       0 : =8H                 R8         EQU     8         ;REGISTER DEFINITION
      76/       0 : =9H                 R9         EQU     9         ;REGISTER DEFINITION
      77/       0 : =0AH                RA         EQU     10        ;REGISTER DEFINITION
      78/       0 : =0BH                RB         EQU     11        ;REGISTER DEFINITION
      79/       0 : =0CH                RC         EQU     12        ;REGISTER DEFINITION
      80/       0 : =0DH                RD         EQU     13        ;REGISTER DEFINITION
      81/       0 : =0EH                RE         EQU     14        ;REGISTER DEFINITION
      82/       0 : =0FH                RF         EQU     15        ;REGISTER DEFINITION
      83/       0 :                     ;
      84/       0 :                     ; The Following Register And EQU Assignments Are Not Used
      85/       0 :                     ; In Every Part Of Program
      86/       0 :                     ;
      87/       0 :                     ; REGISTER ASSIGNMENTS:
      88/       0 :                     ;
      89/       0 :                     ;      0 ; PC (VIA RESET) AT ENTRY
      90/       0 :                     ;      1 ; INTERRUPT PROGRAM COUNTER
      91/       0 :                     ;      2 ; STACK POINTER
      92/       0 :                     ;      3 ; NORMAL PROGRAM COUNTER
      93/       0 :                     ;      4 ; BASIC: SCRT "CALL" PC
      94/       0 :                     ;      5 ; BASIC: SCRT "RETURN" PC
      95/       0 :                     ;      6 ; BASIC: SCRT RETURN ADDR.
      96/       0 :                     ;      7 ; BASIC: PC FOR "FECH"
      97/       0 : =8H                 XX         EQU     8         ;BASIC: WORK REGISTER
      98/       0 : =9H                 PC         EQU     9         ;IL PROGRAM COUNTER
      99/       0 : =0AH                AC         EQU     10        ;BASIC: 16-BIT ACCUMULATOR
     100/       0 : =0BH                BP         EQU     11        ;BASIC POINTER
     101/       0 :                     ;     12                     SERIAL AND TAPE ROUTINES
     102/       0 : =0DH                PZ         EQU     13        ;BASE: PAGE 0 POINTER
     103/       0 :                     ;     14 ;      RE.0=BAUD RATE CONSTANT
     104/       0 :                     ;            IF RE.0=0 USES 1861 AND KEYBOARD P7,EF3
     105/       0 :                     ;               RE.1=  USED FOR INPUT,OUTPUT
     106/       0 : =0FH                X          EQU     15        ;BASIC: SCRATCH REGISTER
     107/       0 :                     ;
     108/       0 :                     ; DISPLAY BUFFER EQU
     109/       0 :                     ;
     110/       0 : =0DB0H              BUFF       EQU     0DB0h     ;ONLY CHANGE PAGE, UNLESS YOU
     111/       0 : =0F08H              BUFE       EQU     BUFF+344  ;WANT TO CHANGE INTERUPT ROUTINE
     112/       0 : =0F40H              BUFX       EQU     BUFE+56   ;ALSO LIMITED TO 1DB0 BY PLOT
     113/       0 :                     ;
     114/       0 : =0F000H             MONITOR    EQU     0F000h    ;Monitor address
     115/       0 :                     ;Putting C8 in first byte allows Monitor To Run instead of Tiny
     116/       0 : C0 01 00            PAGE       LBR     COLDV
     117/       3 : C0 F0 00                       LBR     MONITOR
     118/       6 : D0                             SEP     R0
     119/       7 : 00                             IDL
     120/       8 :                     ;
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 3 - 09/30/24 17:27:32


     121/       8 :                     ;  DATA AREA, COULD BE EQUATES
     122/       8 :                     ;
     123/       8 : 0F                  TVXY       DB      00Fh       ;DISPLAY CURSOR LOCATION
     124/       9 : 00                             DB      000h
     125/       A : 00                             DB      000h       ;BIT LOCATION OF CURSOR
     126/       B : 00                             DB      000h
     127/       C : E0                  MASK       DB      0E0h
     128/       D : 9A                  TIME_      DB      09Ah
     129/       E : 27                             DB      027h
     130/       F : 3A                             DB      03Ah
     131/      10 : 00                             DB      000h
     132/      11 : 00                             DB      000h
     133/      12 : 00                             DB      000h
     134/      13 : 08                  BS         DB      008h
     135/      14 : 1B                  CAN        DB      01Bh
     136/      15 : 00                  PAD        DB      000h
     137/      16 : 00                  TAPEMODE   DB      000h
     138/      17 : 19                  SPARE      DB      019h
     139/      18 : 19                  XEQ        DB      019h
     140/      19 : 34                  LEND       DB      034h
     141/      1A : 80                  AEPTR      DB      080h
     142/      1B : 00                  TTYCC      DB      000h
     143/      1C : 07 73               NXA        DW      00773h
     144/      1E : 07 66               AIL        DW      00766h
     145/      20 : 0F 40               BASIC      DW      00F40h     ;LOWEST ADD. FOR PROGRAM
     146/      22 : 3F F7               STACK      DW      03FF7h     ;HIGHEST ADD. FOR PROGRAM
     147/      24 : 10 9B               MEND       DW      0109Bh     ;PROGRAM END + STACK RESERVE
     148/      26 : 3F F7               TOPS       DW      03FF7h     ;TOP OF GOSUB STACK
     149/      28 : 00 AA               LINO       DW      000AAh     ;CURRENT BASIC LINE NUMBER
     150/      2A : 10 83               WORK       DW      01083h
     151/      2C : 00 34                          DW      00034h
     152/      2E : 00 33               SP         DW      00033h
     153/      30 : 00 00               LINE       DW      00000h     ;INPUT LINE BUFFER
     154/      32 :                     ;
     155/      80 :                                ORG     080h
     156/      80 : 00 00               AESTK      DW      00000h     ;RANDOM NUMBER GEN.
     157/      82 : 00 00                          DW      00000h     ;VAR. A
     158/      84 : 00 00                          DW      00000h     ;VAR. B
     159/      86 : 00 00                          DW      00000h     ;VAR. C
     160/      88 : 00 00                          DW      00000h     ;VAR. D
     161/      8A : 00 00                          DW      00000h     ;VAR. E
     162/      8C : 00 00                          DW      00000h     ;VAR. F
     163/      8E : 00 00                          DW      00000h     ;VAR. G
     164/      90 : 00 00                          DW      00000h     ;VAR. H
     165/      92 : 00 00                          DW      00000h     ;VAR. I
     166/      94 : 00 00                          DW      00000h     ;VAR. J
     167/      96 : 00 00                          DW      00000h     ;VAR. K
     168/      98 : 00 00                          DW      00000h     ;VAR. L
     169/      9A : 00 00                          DW      00000h     ;VAR. M
     170/      9C : 00 00                          DW      00000h     ;VAR. N
     171/      9E : 00 00                          DW      00000h     ;VAR. O
     172/      A0 : 00 00                          DW      00000h     ;VAR. P
     173/      A2 : 00 00                          DW      00000h     ;VAR. Q
     174/      A4 : 00 00                          DW      00000h     ;VAR. R
     175/      A6 : 00 00                          DW      00000h     ;VAR. S
     176/      A8 : 00 00                          DW      00000h     ;VAR. T
     177/      AA : 00 00                          DW      00000h     ;VAR. U
     178/      AC : 00 00                          DW      00000h     ;VAR. V
     179/      AE : 00 00                          DW      00000h     ;VAR. W
     180/      B0 : 00 00                          DW      00000h     ;VAR. X
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 4 - 09/30/24 17:27:32


     181/      B2 : 00 00                          DW      00000h     ;VAR. Y
     182/      B4 : 00 00                          DW      00000h     ;VAR. Z
     183/      B6 : A7                  Z165       PLO     R7         ;I/O ROUTINES
     184/      B7 : C3 02 1A                       LBDF    PEND       ;GOTO WARM START
     185/      BA : 9D                             GHI     RD
     186/      BB : (MACRO)             Z149       KB_B      Z148     ;CHECK FOR KEYBOARD OR SERIAL
     186/      BB : 36 E1                               B3 Z148
     187/      BD : (MACRO)                        SERIAL_B      Z149 ;INPUT
     187/      BD : 37 BB                               B4 Z149
     188/      BF : (MACRO)             Z150       KB_B      Z148
     188/      BF : 36 E1                               B3 Z148
     189/      C1 : (MACRO)                        SERIAL_BN    Z150  ;FINED TIMING OF SERIAL INPUT
     189/      C1 : 3F BF                               BN4 Z150
     190/      C3 : 7B                             SEQ
     191/      C4 : AE                  Z153       PLO     RE
     192/      C5 : F8 08                          LDI     8
     193/      C7 : FF 01               Z151       SMI     1
     194/      C9 : 3A C7                          BNZ     Z151
     195/      CB : 8E                             GLO     RE
     196/      CC : FC 02                          ADI     2
     197/      CE : 39 D3                          BNQ     Z152
     198/      D0 : (MACRO)                        SERIAL_B      Z153
     198/      D0 : 37 C4                               B4 Z153
     199/      D2 : 7A                             REQ
     200/      D3 : (MACRO)             Z152       SERIAL_BN    Z153       ;MUST GOTO #C4
     200/      D3 : 3F C4                               BN4 Z153
     201/      D5 : C4                             NOP                     ;|
     202/      D6 : C4                             NOP                     ;|
     203/      D7 : FF 01                          SMI     1               ;|
     204/      D9 : (MACRO)                        SERIAL_BN    Z154       ;|
     204/      D9 : 3F DE                               BN4 Z154
     205/      DB : 3A D4                          BNZ     Z152+1          ;BECAUSE OF THIS
     206/      DD : 1E                             INC     RE
     207/      DE : 8E                  Z154       GLO     RE
     208/      DF : FF 06                          SMI     6
     209/      E1 : BE                  Z148       PHI     RE
     210/      E2 : F8 0C                          LDI     00Ch
     211/      E4 : (MACRO)                        CALL    OUTPUTR    ;OUTPUT 0C  CLEARSCREEN
     211/      E4 : D4                          SEP R4
     211/      E5 : 0A 83                       dw OUTPUTR
     212/      E7 : C0 02 04                       LBR     CLEAR
     213/      EA : FC 00               BRKTST     ADI     0          ;BREAK TEST
     214/      EC : 9E                             GHI     RE
     215/      ED : 3A F2                          BNZ     Z156
     216/      EF : (MACRO)                        KB_BN     Z157
     216/      EF : 3E FF                               BN3 Z157
     217/      F1 : C8                             LSKP
     218/      F2 : (MACRO)             Z156       SERIAL_B      Z157
     218/      F2 : 37 FF                               B4 Z157
     219/      F4 : FF 00                          SMI     0
     220/      F6 : 9E                  SERIAL_DELAY       GHI     RE
     221/      F7 : FA FE                          ANI     0FEh
     222/      F9 : AE                  Z158       PLO     RE
     223/      FA : CE                             LSZ
     224/      FB : 2E                             DEC     RE
     225/      FC : 8E                             GLO     RE
     226/      FD : 3A F9                          BNZ     Z158
     227/      FF : (MACRO)             Z157       RETURN
     227/      FF : D5                          SEP R5
     228/     100 : C4                  COLDV      NOP                ;COLD START
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 5 - 09/30/24 17:27:32


     229/     101 : 30 B0                          BR      COLD
     230/     103 : C0 01 ED                       LBR     WARM       ;WARM START ENTRY
     231/     106 : C0 0A 5A            KEYV       LBR     INPUTR     ;BRANCH TO CHARATER INPUT
     232/     109 : C0 0A 83            TYPEV      LBR     OUTPUTR    ;BRANCH TO CHARATER OUPUT
     233/     10C : C0 00 EA            BREAKV     LBR     BRKTST     ;BRANCH TO BREAK TEST
     234/     10F :                     ; DEFAULTS LOADED TO DIRECT PAGE
     235/     10F : 08                             DB      008h       ;BACKSPACE CODE
     236/     110 : 1B                             DB      01Bh       ;LINE CANCEL CODE
     237/     111 : 00                             DB      000h       ;PAD CHARATER
     238/     112 : 00                             DB      000h       ;TAPE MODE ENABLE FLAG 80=ENABLED
     239/     113 : 19                             DB      019h       ;SPARE STACK SIZE
     240/     114 : 30 22               ILPEEK     BR      PEEK       ;BRANCH TO PEEK
     241/     116 : 00                             DB      000h
     242/     117 : 00                             DB      000h
     243/     118 : 58                  ILPOKE     DB      058h       ;POKE
     244/     119 : D5                             DB      0D5h
     245/     11A : 07 66                          DW      STRT       ;ADDRESS OF IL PROGRAM START
     246/     11C : 0F 40               CONST      DW      00F40h     ;DEFAULT START OF PROGRAM SPACE
     247/     11E : 7F                             DB      07Fh       ;END MEM STOP
     248/     11F : 00                             DB      000h
     249/     120 :                     ; END DEFAULTS
     250/     120 : 48                             LDA     R8         ;DOUBLE PEEK ENTRY
     251/     121 : 38                             SKP
     252/     122 : 9D                  PEEK       GHI     RD         ;PEEK ENTRY
     253/     123 : BA                             PHI     RA
     254/     124 : 48                             LDA     R8
     255/     125 : (MACRO)                        RETURN
     255/     125 : D5                          SEP R5
     256/     126 : C0 07 51            ILINPOUT   LBR     IO
     257/     129 : D3                  CALL_S     SEP     R3
     258/     12A : BF                  CALL_      PHI     RF         ;CALL ROUTINE
     259/     12B : E2                             SEX     R2
     260/     12C : 86                             GLO     R6
     261/     12D : 73                             STXD
     262/     12E : 96                             GHI     R6
     263/     12F : 73                             STXD
     264/     130 : 83                             GLO     R3
     265/     131 : A6                             PLO     R6
     266/     132 : 93                             GHI     R3
     267/     133 : B6                             PHI     R6
     268/     134 : 46                             LDA     R6
     269/     135 : B3                             PHI     R3
     270/     136 : 46                             LDA     R6
     271/     137 : A3                             PLO     R3
     272/     138 : 9F                             GHI     RF
     273/     139 : 30 29                          BR      CALL_S
     274/     13B : D3                  RETURN_S   SEP     R3
     275/     13C : BF                  RETURN_    PHI     RF         ;RETURN ROUTINE
     276/     13D : E2                             SEX     R2
     277/     13E : 96                             GHI     R6
     278/     13F : B3                             PHI     R3
     279/     140 : 86                             GLO     R6
     280/     141 : A3                             PLO     R3
     281/     142 : 12                             INC     R2
     282/     143 : 42                             LDA     R2
     283/     144 : B6                             PHI     R6
     284/     145 : 02                             LDN     R2
     285/     146 : A6                             PLO     R6
     286/     147 : 9F                             GHI     RF
     287/     148 : 30 3B                          BR      RETURN_S
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 6 - 09/30/24 17:27:32


     288/     14A : D3                             SEP     R3
     289/     14B : 43                  FETCH_     LDA     R3         ;LOAD TEMP IMMEDIATE ROUTINE
     290/     14C : AD                             PLO     RD
     291/     14D : F8 00                          LDI     (PAGE)&255 ;MEMORY BASE PAGE
     292/     14F : BD                             PHI     RD
     293/     150 : 4D                             LDA     RD
     294/     151 : ED                             SEX     RD         ;AND SET X TO D AND +
     295/     152 : 30 4A                          BR      FETCH_-1
     296/     154 : 02 98               TABLE      DW      BACK
     297/     156 : 02 A0                          DW      HOP
     298/     158 : 03 1F                          DW      MATCH
     299/     15A : 02 DD                          DW      TSTV
     300/     15C : 02 F0                          DW      TSTN
     301/     15E : 02 D4                          DW      TEND
     302/     160 : 05 81                          DW      RTN
     303/     162 : 03 49                          DW      HOOK
     304/     164 : 01 ED                          DW      WARM
     305/     166 : 05 4E                          DW      XINIT
     306/     168 : 02 04                          DW      CLEAR
     307/     16A : 06 A2                          DW      INSRT
     308/     16C : 02 D3                          DW      RETN
     309/     16E : 02 D3                          DW      RETN
     310/     170 : 05 AA                          DW      GETLN
     311/     172 : 02 D3                          DW      RETN
     312/     174 : 02 D3                          DW      RETN
     313/     176 : 03 C5                          DW      STRNG
     314/     178 : 03 D5                          DW      CRLF
     315/     17A : 04 03                          DW      TAB
     316/     17C : 03 79                          DW      PRS
     317/     17E : 04 18                          DW      PRN
     318/     180 : 06 3C                          DW      LIST
     319/     182 : 02 D3                          DW      RETN
     320/     184 : 05 29                          DW      NXT
     321/     186 : 04 6C                          DW      CMPR
     322/     188 : 04 CB                          DW      IDIV
     323/     18A : 04 A7                          DW      IMUL
     324/     18C : 04 98                          DW      ISUB
     325/     18E : 04 9B                          DW      IADD
     326/     190 : 05 0E                          DW      INEG
     327/     192 : 05 60                          DW      XFER
     328/     194 : 05 6D                          DW      RSTR
     329/     196 : 06 81                          DW      SAV
     330/     198 : 02 B6                          DW      STORE
     331/     19A : 03 67                          DW      IND
     332/     19C : 04 48                          DW      RSBP
     333/     19E : 04 4B                          DW      SVBP
     334/     1A0 : 02 D3                          DW      RETN
     335/     1A2 : 02 D3                          DW      RETN
     336/     1A4 : 02 C9                          DW      BPOP
     337/     1A6 : 02 C5                          DW      APOP
     338/     1A8 : 03 4E                          DW      DUPS
     339/     1AA : 03 44                          DW      LITN
     340/     1AC : 03 41                          DW      LIT1
     341/     1AE : 02 D3                          DW      RETN
     342/     1B0 :                     TBEND:
     343/     1B0 :                     ; COLD & WARM START INITIALIZATION ;
     344/     1B0 :                     ;
     345/     1B0 :                     ; COLD START;
     346/     1B0 :                     ;
     347/     1B0 : F8 B3               COLD       LDI     ($+3)&255   ;CHANGE PROGRAM COUNTER
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 7 - 09/30/24 17:27:32


     348/     1B2 : A3                             PLO     R3        ;FROM R0 TO R3
     349/     1B3 : F8 01                          LDI     ($)>>8
     350/     1B5 : B3                             PHI     R3
     351/     1B6 : D3                             SEP     R3
     352/     1B7 :                     ; DETERMINE SIZE OF USER RAM
     353/     1B7 : BA                             PHI     AC        ;GET LOW END ADDR.
     354/     1B8 : F8 1C                          LDI     (CONST)&255 ;OF USER PROGRAM
     355/     1BA : AA                             PLO     AC        ;RAM (AT "CONST")
     356/     1BB : 4A                             LDA     AC
     357/     1BC : B2                             PHI     R2        ;..AND PUT IN R2
     358/     1BD : 4A                             LDA     AC
     359/     1BE : A2                             PLO     R2
     360/     1BF : 4A                             LDA     AC        ;SET PZ TO WRAP POINT
     361/     1C0 : BD                             PHI     PZ        ;(END OF SEARCH)
     362/     1C1 : F8 FF                          LDI     0FFh
     363/     1C3 : AD                             PLO     PZ
     364/     1C4 : 0D                             LDN     PZ        ;..AND SAVE BYTE
     365/     1C5 : BF                             PHI     X         ;NOW AT ADDR. PZ
     366/     1C6 : E2                  SCAN       SEX     R2        ;REPEAT TO SEARCH RAM..
     367/     1C7 : 12                             INC     R2        ;- GET NEXT BYTE
     368/     1C8 : F0                             LDX
     369/     1C9 : AF                             PLO     X         ;- SAVE A COPY
     370/     1CA : FB FF                          XRI     0FFh      ;- COMPLEMENT IT
     371/     1CC : 52                             STR     R2        ;- STORE IT
     372/     1CD : F3                             XOR               ;- SEE IF IT WORKED
     373/     1CE : ED                             SEX     PZ
     374/     1CF : C6                             LSNZ              ;- IF MATCHES, IS RAM
     375/     1D0 : 9F                             GHI     X         ;SET CARRY IF AT
     376/     1D1 : F3                             XOR               ;WRAP POINT..
     377/     1D2 : FC FF                          ADI     0FFh      ;- ELSE IS NOT RAM
     378/     1D4 : 8F                             GLO     X         ;RESTORE ORIGINAL BYTE
     379/     1D5 : 52                             STR     R2
     380/     1D6 : 3B C6                          BNF     SCAN      ;- ..UNTIL END OR WRAP POINT
     381/     1D8 : 22                             DEC     R2
     382/     1D9 : 0A                             LDN     AC        ;RAM SIZED: SET
     383/     1DA : BD                             PHI     PZ        ;POINTER PZ TO
     384/     1DB : F8 23                          LDI     STACK+1   ;WORK AREA
     385/     1DD : AD                             PLO     PZ
     386/     1DE : 82                             GLO     R2        ;STORE RAM END ADDRESS
     387/     1DF : 73                             STXD
     388/     1E0 : 92                             GHI     R2
     389/     1E1 : 73                             STXD              ;GET & STORE RAM BEGINNIG
     390/     1E2 : 2A                             DEC     AC        ;REPEAT TO COPY PARAMETERS..
     391/     1E3 : 2A                             DEC     AC        ;- POINT TO NEXT
     392/     1E4 : 0A                             LDN     AC        ;- GET PARAMETER
     393/     1E5 : 73                             STXD              ;- STORE IN WORK AREA
     394/     1E6 : 8D                             GLO     PZ
     395/     1E7 : FB 12                          XRI     BS-1      ;- TEST FOR LAST PARAMETER
     396/     1E9 : 3A E3                          BNZ     $-6       ;- ..UNTIL LAST COPIED
     397/     1EB : F6                             SHR               ;SET DF=0 FOR "CLEAR"
     398/     1EC : C8                             LSKP
     399/     1ED :                     ;
     400/     1ED :                     ; WARM START:
     401/     1ED :                     ;
     402/     1ED : FF 00               WARM       SMI     0         ;SET DF=1 FOR "DON'T CLEAR"
     403/     1EF : F8 F2                          LDI     ($+3)&255
     404/     1F1 : A3                             PLO     R3        ;BE SURE PROGRAM COUNTER IS R3
     405/     1F2 : F8 01                          LDI     ($)>>8
     406/     1F4 : B3                             PHI     R3
     407/     1F5 : D3                             SEP     R3
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 8 - 09/30/24 17:27:32


     408/     1F6 : B4                             PHI     R4        ;INITIALIZE R4, R5, R7
     409/     1F7 : B5                             PHI     R5        ;ASSUMES CALL,RETURN,FETCH
     410/     1F8 : B7                             PHI     R7        ;IS IN SAME PAGE AS WARM
     411/     1F9 : F8 2A                          LDI     (CALL_)&255
     412/     1FB : A4                             PLO     R4
     413/     1FC : F8 3C                          LDI     (RETURN_)&255
     414/     1FE : A5                             PLO     R5
     415/     1FF : F8 4B                          LDI     (FETCH_)&255
     416/     201 : C0 00 B6                       LBR     Z165       ;GOTO #00B6
     417/     204 : (MACRO)             CLEAR      FETCH   BASIC;- MARK PROGRAM EMPTY
     417/     204 : D7                          SEP R7
     417/     205 : 20                          db (BASIC)&255
     418/     206 : BB                             PHI     BP
     419/     207 : 4D                             LDA     PZ
     420/     208 : AB                             PLO     BP
     421/     209 : (MACRO)                        LDI0               ;WITH LINE# = 0
     421/     209 : 9D                          GHI RD 
     422/     20A : 5B                             STR     BP
     423/     20B : 1B                             INC     BP
     424/     20C : 5B                             STR     BP
     425/     20D : (MACRO)                        FETCH   SPARE-1 ;SET MEND = START + SPARE
     425/     20D : D7                          SEP R7
     425/     20E : 16                          db (SPARE-1)&255
     426/     20F : 8B                             GLO     BP         ;GET START
     427/     210 : F4                             ADD                ;ADD ;LOW BYTE OF SPARE
     428/     211 : BF                             PHI     X          ;SAVE TEMPORARILY
     429/     212 : (MACRO)                        FETCH   MEND       ;GET MEND
     429/     212 : D7                          SEP R7
     429/     213 : 24                          db (MEND)&255
     430/     214 : 9F                             GHI     X
     431/     215 : 73                             STXD               ;STORE LOW BYTE OF MEND
     432/     216 : 9B                             GHI     BP
     433/     217 : 7C 00                          ADCI    0          ;ADD CARRY
     434/     219 : 73                             STXD               ;STORE ;HIGH BYTE OF MEND
     435/     21A : (MACRO)             PEND       FETCH   STACK ;SET STACK TO END OF MEMORY
     435/     21A : D7                          SEP R7
     435/     21B : 22                          db (STACK)&255
     436/     21C : B2                             PHI     R2
     437/     21D : 4D                             LDA     PZ
     438/     21E : A2                             PLO     R2
     439/     21F : (MACRO)                        FETCH   TOPS
     439/     21F : D7                          SEP R7
     439/     220 : 26                          db (TOPS)&255
     440/     221 : 82                             GLO     R2        ;SET TOPS TO EMPTY
     441/     222 : 73                             STXD              ;(I.E. STACK END)
     442/     223 : 92                             GHI     R2
     443/     224 : 73                             STXD
     444/     225 : (MACRO)                        CALL    FORCE     ;SET TAPE MODE "OFF"
     444/     225 : D4                          SEP R4
     444/     226 : 03 CC                       dw FORCE
     445/     228 : (MACRO)             IIL        FETCH   AIL       ;SET IL PC
     445/     228 : D7                          SEP R7
     445/     229 : 1E                          db (AIL)&255
     446/     22A : B9                             PHI     PC
     447/     22B : 4D                             LDA     PZ
     448/     22C : A9                             PLO     PC        ;CONTINUE INTO "NEXT"
     449/     22D :                     ;
     450/     22D :                     ; EXECUTE NEXT INTERMEDIATE LANGUAGE (IL) INSTRUCTION
     451/     22D :                     ;
     452/     22D : E2                  NEXT       SEX     R2        ;GET OPCODE
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 9 - 09/30/24 17:27:32


     453/     22E : 49                             LDA     PC
     454/     22F : FF 30                          SMI     030h      ;IF JUMP OR BRANCH,
     455/     231 : 33 4B                          BDF     TBR       ;GO HANDLE IT
     456/     233 : FD D7                          SDI     0D7h      ;IF STACK BYTE EXCHANGE,
     457/     235 : 33 85                          BDF     XCHG      ;GO HANDLE IT
     458/     237 : FE                             SHL               ;ELSE ;MULTIPLY BY 2
     459/     238 : FC B0                          ADI     (TBEND)&255  ;TO POINT INTO TABLE
     460/     23A : A6                             PLO     R6
     461/     23B : F8 2D                          LDI     (NEXT)&255   ;& SET RETURN TO HERE
     462/     23D : 22                             DEC     R2           ;(DUMMY STACK ENTRY)
     463/     23E : 22                             DEC     R2
     464/     23F : 73                             STXD
     465/     240 : 93                             GHI     R3
     466/     241 : 73                             STXD
     467/     242 : 97                  DOIT       GHI     R7        ;TABLE PAGE
     468/     243 : B6                             PHI     R6
     469/     244 : 46                             LDA     R6        ;FETCH SERVICE ADDRESS
     470/     245 : 52                             STR     R2
     471/     246 : 46                             LDA     R6
     472/     247 : A6                             PLO     R6
     473/     248 : F0                             LDX
     474/     249 : B6                             PHI     R6
     475/     24A : D5                             SEP     R5        ;GO DO IT
     476/     24B :                     ;
     477/     24B : FF 10               TBR        SMI     010h      ;IF JUMP OR CALL,
     478/     24D : 3B 6A                          BNF     TJMP      ;GO DO IT
     479/     24F : A6                             PLO     R6        ;ELSE BRANCH; SAVE OPCODE
     480/     250 : FA 1F                          ANI     01Fh      ;COMPUTE DESTINATION
     481/     252 : 32 5C                          BZ      TBERR     ;IF BRANCh, 0ADh DR = 0, GOTO ERROR
     482/     254 : 52                             STR     R2        ;PUSh, 0ADh DRESS ONTO STACK
     483/     255 : 89                             GLO     PC        ;ADD RELATIVE OFFSET
     484/     256 : F4                             ADD               ;LOW BYTE
     485/     257 : 73                             STXD
     486/     258 : 99                             GHI     PC        ;HIGH BYTE W. CARRY
     487/     259 : 7C 00                          ADCI    0
     488/     25B : 38                             SKP
     489/     25C : 73                  TBERR      STXD              ;STORE 0 FOR ERROR
     490/     25D : 73                             STXD
     491/     25E : 86                             GLO     R6        ;NOW COMPUTE SERVICE ADDRESS
     492/     25F : F6                             SHR               ;WHICH ;IS HIGH 3 BITS
     493/     260 : F6                             SHR
     494/     261 : F6                             SHR
     495/     262 : F6                             SHR
     496/     263 : FA FE                          ANI     0FEh
     497/     265 : FC 54                          ADI     (TABLE)&255 ;INDEX INTO TABLE
     498/     267 : A6                             PLO     R6
     499/     268 : 30 42                          BR      DOIT
     500/     26A :                     ;
     501/     26A : FC 08               TJMP       ADI     8         ;NOTE IF JUMP IN CARRY
     502/     26C : FA 07                          ANI     7         ;GET ADDRESS
     503/     26E : B6                             PHI     R6
     504/     26F : 49                             LDA     PC
     505/     270 : A6                             PLO     R6
     506/     271 : 33 7A                          BDF     JMP       ;JUMP
     507/     273 : 89                             GLO     PC        ;PUSH PC
     508/     274 : 73                             STXD
     509/     275 : 99                             GHI     PC
     510/     276 : 73                             STXD
     511/     277 : (MACRO)                        CALL    STEST     ;CHECK STACK DEPTH
     511/     277 : D4                          SEP R4
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 10 - 09/30/24 17:27:32


     511/     278 : 03 37                       dw STEST
     512/     27A :                     ;
     513/     27A : (MACRO)             JMP        FETCH   AIL       ;ADD JUMP ADDRESS TO IL BASE
     513/     27A : D7                          SEP R7
     513/     27B : 1E                          db (AIL)&255
     514/     27C : 86                             GLO     R6
     515/     27D : F4                             ADD
     516/     27E : A9                             PLO     PC
     517/     27F : 96                             GHI     R6
     518/     280 : 2D                             DEC     PZ
     519/     281 : 74                             ADC
     520/     282 : B9                             PHI     PC
     521/     283 : 30 2D                          BR      NEXT
     522/     285 :                     ;
     523/     285 : FD 07               XCHG       SDI     7         ;SAVE OFFSET
     524/     287 : 52                             STR     R2
     525/     288 : (MACRO)                        FETCH   AEPTR
     525/     288 : D7                          SEP R7
     525/     289 : 1A                          db (AEPTR)&255
     526/     28A : AD                             PLO     PZ
     527/     28B : E2                             SEX     R2
     528/     28C : F4                             ADD
     529/     28D : A6                             PLO     R6        ;R6 IS OTHER POINTER
     530/     28E : 9D                             GHI     PZ
     531/     28F : B6                             PHI     R6
     532/     290 : 0D                             LDN     PZ        ;NOW SWAP THEM:
     533/     291 : 52                             STR     R2        ;SAVE OLD TOP
     534/     292 : 06                             LDN     R6        ;GET INNER BYTE
     535/     293 : 5D                             STR     PZ        ;PUT ON TOP
     536/     294 : 02                             LDN     R2        ;GET OLD TOP
     537/     295 : 56                             STR     R6        ;PUT IN
     538/     296 : 30 2D                          BR      NEXT
     539/     298 :                     ;
     540/     298 : 86                  BACK       GLO     R6        ;REMOVE OFFSET
     541/     299 : FF 20                          SMI     020h      ;FOR BACKWARDS HOP
     542/     29B : A6                             PLO     R6
     543/     29C : 96                             GHI     R6
     544/     29D : 7F 00                          SMBI    0
     545/     29F : 38                             SKP
     546/     2A0 :                     ;
     547/     2A0 : 96                  HOP        GHI     R6        ;FORWARD HOP
     548/     2A1 : C2 03 7F                       LBZ     ERR       ;IF ZERO, GOTO ERROR
     549/     2A4 : B9                             PHI     PC        ;ELSE PUT INTO PC
     550/     2A5 : 86                             GLO     R6
     551/     2A6 : A9                             PLO     PC
     552/     2A7 : 30 2D                          BR      NEXT
     553/     2A9 :                     ;
     554/     2A9 : 1B                             INC     BP        ;ADVANCE TO NEXT NON-BLANK CHAR.
     555/     2AA : 0B                  NONBL      LDN     BP        ;GET CHARACTER
     556/     2AB : FF 20                          SMI     020h      ;IF BLANK,
     557/     2AD : 32 A9                          BZ      NONBL-1   ;INCREMENT POINTER AND TRY AGAIN
     558/     2AF : FF 10                          SMI     010h      ;IF NUMERIC (0-9),
     559/     2B1 : C7                             LSNF
     560/     2B2 : FD 09                          SDI     9         ;SET DF=1
     561/     2B4 : 0B                  NONBX      LDN     BP        ;GET CHARACTER
     562/     2B5 : (MACRO)                        RETURN              AND ;RETURN
     562/     2B5 : D5                          SEP R5
     563/     2B6 :                     ;
     564/     2B6 : (MACRO)             STORE      CALL    APOP      ;GET VARIABLE
     564/     2B6 : D4                          SEP R4
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 11 - 09/30/24 17:27:32


     564/     2B7 : 02 C5                       dw APOP
     565/     2B9 : 4D                             LDA     PZ        ;GET POINTER
     566/     2BA : AD                             PLO     PZ
     567/     2BB : 9A                             GHI     AC        ;STORE THE NUMBER
     568/     2BC : 5D                             STR     PZ
     569/     2BD : 1D                             INC     PZ
     570/     2BE : 8A                             GLO     AC
     571/     2BF : 5D                             STR     PZ
     572/     2C0 : 30 C9                          BR      BPOP      ;GO POP POINTER
     573/     2C2 :                     ;
     574/     2C2 : (MACRO)                        CALL    APOP      ;POP 4 BYTES
     574/     2C2 : D4                          SEP R4
     574/     2C3 : 02 C5                       dw APOP
     575/     2C5 : (MACRO)             APOP       CALL    BPOP      ;POP 2 BYTES
     575/     2C5 : D4                          SEP R4
     575/     2C6 : 02 C9                       dw BPOP
     576/     2C8 : BA                             PHI     AC        ;FIRST BYTE TO AC.1
     577/     2C9 : (MACRO)             BPOP       FETCH   AEPTR ;POP 1 BYTE
     577/     2C9 : D7                          SEP R7
     577/     2CA : 1A                          db (AEPTR)&255
     578/     2CB : 2D                             DEC     PZ
     579/     2CC : FC 01                          ADI     1         ;INCREMENT
     580/     2CE : 5D                             STR     PZ
     581/     2CF : AD                             PLO     PZ
     582/     2D0 : 2D                             DEC     PZ
     583/     2D1 : 4D                             LDA     PZ        ;LEAVE IT IN D
     584/     2D2 : AA                             PLO     AC        ;AND AC.0
     585/     2D3 : (MACRO)             RETN       RETURN
     585/     2D3 : D5                          SEP R5
     586/     2D4 :                     ;
     587/     2D4 : (MACRO)             TEND       CALL    NONBL     ;GET NEXT CHARACTER
     587/     2D4 : D4                          SEP R4
     587/     2D5 : 02 AA                       dw NONBL
     588/     2D7 : FB 0D                          XRI     00Dh      ;IF CARRIAGE RETURN,
     589/     2D9 : 32 2D                          BZ      NEXT      ;THEN FALL THRU IN IL
     590/     2DB : 30 A0                          BR      HOP       ;ELSE TAKE BRANCH
     591/     2DD :                     ;
     592/     2DD : (MACRO)             TSTV       CALL    NONBL     ;GET NEXT CHARACTER
     592/     2DD : D4                          SEP R4
     592/     2DE : 02 AA                       dw NONBL
     593/     2E0 : FF 41                          SMI     041h      ;IF LESS THAN 'A',
     594/     2E2 : 3B A0                          BNF     HOP       ;THEN HOP
     595/     2E4 : FF 1A                          SMI     01Ah      ;IF GREATER THAN 'Z'
     596/     2E6 : 33 A0                          BDF     HOP       ;THEN HOP
     597/     2E8 : 1B                             INC     BP        ;ELSE IS LETTER A-Z
     598/     2E9 : 9F                             GHI     X         ;GET SAVED COPY
     599/     2EA : FE                             SHL               ;CONVERT ;TO VARIABLE'S ADDRESS
     600/     2EB : (MACRO)                        CALL    BPUSH     ;AND PUSH ONTO STACK
     600/     2EB : D4                          SEP R4
     600/     2EC : 03 59                       dw BPUSH
     601/     2EE : 30 2D                          BR      NEXT
     602/     2F0 :                     ;
     603/     2F0 : (MACRO)             TSTN       CALL    NONBL     ;GET NEXT CHARACTER
     603/     2F0 : D4                          SEP R4
     603/     2F1 : 02 AA                       dw NONBL
     604/     2F3 : 3B A0                          BNF     HOP       ;IF NOT A DIGIT, HOP
     605/     2F5 : (MACRO)                        LDI0              ;ELSE COMPUTE NUMBER
     605/     2F5 : 9D                          GHI RD 
     606/     2F6 : BA                             PHI     AC        ;INITIALLY 0
     607/     2F7 : AA                             PLO     AC
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 12 - 09/30/24 17:27:32


     608/     2F8 : (MACRO)                        CALL    APUSH     ;PUSH ONTO STACK
     608/     2F8 : D4                          SEP R4
     608/     2F9 : 03 54                       dw APUSH
     609/     2FB : 4B                  NUMB       LDA     BP        ;GET CHARACTER
     610/     2FC : FA 0F                          ANI     00Fh      ;CONVERT FROM ASCII TO NUMBER
     611/     2FE : AA                             PLO     AC
     612/     2FF : (MACRO)                        LDI0        
     612/     2FF : 9D                          GHI RD 
     613/     300 : BA                             PHI     AC
     614/     301 : F8 0A                          LDI     10        ;ADD 10 TIMES THE..
     615/     303 : AF                             PLO     X
     616/     304 : ED                             SEX     PZ
     617/     305 : 1D                  NM10       INC     PZ
     618/     306 : 8A                             GLO     AC        ;..PREVIOUS VALUE..
     619/     307 : F4                             ADD
     620/     308 : AA                             PLO     AC
     621/     309 : 9A                             GHI     AC
     622/     30A : 2D                             DEC     PZ        ;..WHICH IS ON STACK.
     623/     30B : 74                             ADC
     624/     30C : BA                             PHI     AC
     625/     30D : 2F                             DEC     X         ;COUNT THE ITERATIONS
     626/     30E : 8F                             GLO     X
     627/     30F : 3A 05                          BNZ     NM10
     628/     311 : 9A                             GHI     AC        ;SAVE NEW VALUE
     629/     312 : 5D                             STR     PZ
     630/     313 : 1D                             INC     PZ
     631/     314 : 8A                             GLO     AC
     632/     315 : 73                             STXD
     633/     316 : (MACRO)                        CALL    NONBL     ;IF ANY MORE DIGITS,
     633/     316 : D4                          SEP R4
     633/     317 : 02 AA                       dw NONBL
     634/     319 : C3 02 FB                       LBDF    NUMB      ;THEN DO IT AGAIN
     635/     31C : C0 02 2D            NHOP       LBR     NEXT      ;UNTIL DONE
     636/     31F :                     ;
     637/     31F : 9B                  MATCH      GHI     BP        ;SAVE PB IN CASE NO MATCH
     638/     320 : BA                             PHI     AC
     639/     321 : 8B                             GLO     BP
     640/     322 : AA                             PLO     AC
     641/     323 : (MACRO)             MAL        CALL    NONBL     ;GET A BYTE (IN CAPS)
     641/     323 : D4                          SEP R4
     641/     324 : 02 AA                       dw NONBL
     642/     326 :                     ;
     643/     326 : 1B                             INC     BP        ;COMPARE THEM
     644/     327 : 52                             STR     R2
     645/     328 : 49                             LDA     PC
     646/     329 : F3                             XOR
     647/     32A : 32 23                          BZ      MAL       ;STILL EQUAL
     648/     32C : FB 80                          XRI     80H       ;END?
     649/     32E : 32 1C                          BZ      NHOP      ;YES
     650/     330 : 9A                             GHI     AC        ;NO GOOD
     651/     331 : BB                             PHI     BP        ;PUT POINTER BACK
     652/     332 : 8A                             GLO     AC
     653/     333 : AB                             PLO     BP
     654/     334 : C0 02 A0            JHOP       LBR     HOP       ;THEN TAKE BRANCH
     655/     337 :                     ;
     656/     337 : (MACRO)             STEST      FETCH   MEND ;POINT TO PROGRAM END
     656/     337 : D7                          SEP R7
     656/     338 : 24                          db (MEND)&255
     657/     339 : 82                             GLO     R2        ;COMPARE TO STACK TOP
     658/     33A : F5                             SD
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 13 - 09/30/24 17:27:32


     659/     33B : 2D                             DEC     PZ
     660/     33C : 92                             GHI     R2
     661/     33D : 75                             SDB
     662/     33E : 33 7F                          BDF     ERR       ;AHA; OVERFLOW
     663/     340 : (MACRO)                        RETURN            ;ELSE ;EXIT
     663/     340 : D5                          SEP R5
     664/     341 :                     ;
     665/     341 : 49                  LIT1       LDA     PC        ;ONE BYTE
     666/     342 : 30 59                          BR      BPUSH
     667/     344 : 49                  LITN       LDA     PC        ;TWO BYTES
     668/     345 : BA                             PHI     AC        ;FIRST IS HIGH BYTE,
     669/     346 : 49                             LDA     PC        ;THEN LOW BYTE
     670/     347 : 30 55                          BR      APUSH+1   ;PUSH RESULT ONTO STACK
     671/     349 :                     ;
     672/     349 : (MACRO)             HOOK       CALL    HOOP      ;GO DO IT, LEAVE EXIT HERE
     672/     349 : D4                          SEP R4
     672/     34A : 06 25                       dw HOOP
     673/     34C : 30 55                          BR      APUSH+1   ;PUSH RESULT ONTO STACK
     674/     34E :                     ;
     675/     34E : (MACRO)             DUPS       CALL    APOP      ;POP 2 BYTES INTO AC
     675/     34E : D4                          SEP R4
     675/     34F : 02 C5                       dw APOP
     676/     351 : (MACRO)                        CALL    APUSH     ;THEN PUSH TWICE
     676/     351 : D4                          SEP R4
     676/     352 : 03 54                       dw APUSH
     677/     354 : 8A                  APUSH      GLO     AC        ;PUSH 2 BYTES
     678/     355 : (MACRO)                        CALL    BPUSH
     678/     355 : D4                          SEP R4
     678/     356 : 03 59                       dw BPUSH
     679/     358 : 9A                             GHI     AC
     680/     359 : 52                  BPUSH      STR     R2        ;PUSH ONE BYTE (IN D)
     681/     35A : (MACRO)                        FETCH   LEND ;CHECK FOR OVERFLOW
     681/     35A : D7                          SEP R7
     681/     35B : 19                          db (LEND)&255
     682/     35C : F7                             SM                ;COMPARE ;AEPTR TO LEND
     683/     35D : 33 7F                          BDF     ERR       ;OOPS!
     684/     35F : F8 01                          LDI     1
     685/     361 : F5                             SD
     686/     362 : 5D                             STR     PZ
     687/     363 : AD                             PLO     PZ
     688/     364 : 02                             LDN     R2        ;GET SAVED BYTE
     689/     365 : 5D                             STR     PZ        ;STORE INTO STACK
     690/     366 : (MACRO)             SEP5       RETURN            ;  & RETURN
     690/     366 : D5                          SEP R5
     691/     367 :                     ;
     692/     367 : (MACRO)             IND        CALL    BPOP      ;GET POINTER
     692/     367 : D4                          SEP R4
     692/     368 : 02 C9                       dw BPOP
     693/     36A : AD                             PLO     PZ
     694/     36B : 4D                             LDA     PZ        ;GET VARIABLE
     695/     36C : BA                             PHI     AC
     696/     36D : 4D                             LDA     PZ
     697/     36E : 30 55                          BR      APUSH+1   ;GO PUSH IT
     698/     370 :                     ;
     699/     370 : FB 2F               QUOTE      XRI     02Fh      ;TEST FOR QUOTE
     700/     372 : 32 66                          BZ      SEP5      ;IF QUOTE, GO EXIT
     701/     374 : FB 22                          XRI     022h      ;ELSE RESTORE CHARACTER
     702/     376 : (MACRO)                        CALL    TYPER
     702/     376 : D4                          SEP R4
     702/     377 : 03 F4                       dw TYPER
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 14 - 09/30/24 17:27:32


     703/     379 : 4B                  PRS        LDA     BP        ;GET NEXT BYTE
     704/     37A : FB 0D                          XRI     00Dh      ;IF NOT CARRIAGE RETURN,
     705/     37C : 3A 70                          BNZ     QUOTE     ;THEN CONTINUE
     706/     37E : 29                             DEC     PC        ;ELSE CONTINUE INTO ERROR
     707/     37F :                     ;
     708/     37F : (MACRO)             ERR        FETCH   XEQ       ;ERROR:
     708/     37F : D7                          SEP R7
     708/     380 : 18                          db (XEQ)&255
     709/     381 : B8                             PHI     XX        ;SAVE XEQ FLAG
     710/     382 : (MACRO)                        CALL    FORCE     ;TURN TAPE MODE OFF
     710/     382 : D4                          SEP R4
     710/     383 : 03 CC                       dw FORCE
     711/     385 : F8 21                          LDI     "!"       ;PRINT "!" ON NEW LINE
     712/     387 : (MACRO)                        CALL    TYPER
     712/     387 : D4                          SEP R4
     712/     388 : 03 F4                       dw TYPER
     713/     38A : (MACRO)                        FETCH   AIL
     713/     38A : D7                          SEP R7
     713/     38B : 1E                          db (AIL)&255
     714/     38C : 89                             GLO     PC        ;CONVERT IL PC TO ERROR#
     715/     38D : F7                             SM                ;BY ;SUBTRACTING
     716/     38E : AA                             PLO     AC        ;IL START FROM PC
     717/     38F : 99                             GHI     PC
     718/     390 : 2D                             DEC     PZ        ;X MUST POINT TO
     719/     391 : 77                             SMB               ;PAGE0 ;REGISTER PZ=RD
     720/     392 : BA                             PHI     AC
     721/     393 : (MACRO)                        CALL    PRNA      ;PRINT ERROR#
     721/     393 : D4                          SEP R4
     721/     394 : 04 15                       dw PRNA
     722/     396 : 98                             GHI     XX        ;GET XEQ FLAG
     723/     397 : 32 A9                          BZ      BELL      ;IF XEQ SET,
     724/     399 : F8 BD                          LDI     (ATMSG)&255 ;- THEN TYPE "AT"
     725/     39B : A9                             PLO     PC
     726/     39C : 93                             GHI     R3
     727/     39D : B9                             PHI     PC
     728/     39E : (MACRO)                        CALL    STRNG
     728/     39E : D4                          SEP R4
     728/     39F : 03 C5                       dw STRNG
     729/     3A1 : (MACRO)                        FETCH   LINO ;- GET LINE NUMBER
     729/     3A1 : D7                          SEP R7
     729/     3A2 : 28                          db (LINO)&255
     730/     3A3 : BA                             PHI     AC        ;- AND PRINT IT, TOO
     731/     3A4 : 4D                             LDA     PZ
     732/     3A5 : AA                             PLO     AC
     733/     3A6 : (MACRO)                        CALL    PRNA
     733/     3A6 : D4                          SEP R4
     733/     3A7 : 04 15                       dw PRNA
     734/     3A9 : F8 07               BELL       LDI     7         ;RING THE BELL
     735/     3AB : (MACRO)                        CALL    TYPEV
     735/     3AB : D4                          SEP R4
     735/     3AC : 01 09                       dw TYPEV
     736/     3AE : (MACRO)                        CALL    CRLF      ;PRINT <CR><LF>
     736/     3AE : D4                          SEP R4
     736/     3AF : 03 D5                       dw CRLF
     737/     3B1 : (MACRO)             FIN        FETCH   TTYCC-1
     737/     3B1 : D7                          SEP R7
     737/     3B2 : 1A                          db (TTYCC-1)&255
     738/     3B3 : (MACRO)                        LDI0              ;TURN TAPE MODE OFF
     738/     3B3 : 9D                          GHI RD 
     739/     3B4 : 5D                             STR     PZ
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 15 - 09/30/24 17:27:32


     740/     3B5 : (MACRO)             EXIT       FETCH   TOPS ;RESET STACK POINTER
     740/     3B5 : D7                          SEP R7
     740/     3B6 : 26                          db (TOPS)&255
     741/     3B7 : B2                             PHI     R2
     742/     3B8 : 4D                             LDA     PZ
     743/     3B9 : A2                             PLO     R2
     744/     3BA : C0 02 28                       LBR     IIL       ;RESTART IL FROM BEGINNING
     745/     3BD :                     ;
     746/     3BD : 20 41 54            ATMSG      DB      ' ','A','T' ;ERROR MESSAGE TEMPLATE
     747/     3C0 : 20 A3                          DB      ' ', 0A3H
     748/     3C2 :                     ;
     749/     3C2 : (MACRO)             TSTR       CALL    TYPER-2   ;PRINT CHARACTER STRING
     749/     3C2 : D4                          SEP R4
     749/     3C3 : 03 F2                       dw TYPER-2
     750/     3C5 : 49                  STRNG      LDA     PC        ;GET NEXT CHARACTER OF STRING
     751/     3C6 : FC 80                          ADI     080h      ;IF HI BIT=0,
     752/     3C8 : 3B C2                          BNF     TSTR      ;THEN GO PRINT & CONTINUE
     753/     3CA : 30 F2                          BR      TYPER-2   ;PRINT LAST CHAR AND EXIT
     754/     3CC :                     ;
     755/     3CC : (MACRO)             FORCE      FETCH   AEPTR-1
     755/     3CC : D7                          SEP R7
     755/     3CD : 19                          db (AEPTR-1)&255
     756/     3CE : F8 80                          LDI     AESTK     ;CLEAR A.E.STACK
     757/     3D0 : 73                             STXD
     758/     3D1 : (MACRO)                        LDI0              ;SET "NOT EXECUTING"
     758/     3D1 : 9D                          GHI RD 
     759/     3D2 : 73                             STXD              ;LEND=0 ZERO LINE LENGTH
     760/     3D3 : 73                             STXD              ;XEQ=0 NOT EXECUTING
     761/     3D4 : C8                             LSKP              ;CONTINUE TO CRLF
     762/     3D5 :                     ;
     763/     3D5 : (MACRO)             CRLF       FETCH   TTYCC ;GET COLUMN COUNT
     763/     3D5 : D7                          SEP R7
     763/     3D6 : 1B                          db (TTYCC)&255
     764/     3D7 : FE                             SHL               ;IF IN TAPE MODE (MSB=1),
     765/     3D8 : 33 66                          BDF     SEP5      ;THEN JUST EXIT
     766/     3DA : (MACRO)                        FETCH   PAD       ;GET # OF PAD CHARS
     766/     3DA : D7                          SEP R7
     766/     3DB : 15                          db (PAD)&255
     767/     3DC : AA                             PLO     AC        ;& SAVE IT
     768/     3DD : F8 0D                          LDI     00Dh      ;TYPE <CR>
     769/     3DF : (MACRO)             PADS       CALL    TYPEV
     769/     3DF : D4                          SEP R4
     769/     3E0 : 01 09                       dw TYPEV
     770/     3E2 : (MACRO)                        FETCH   TTYCC-1 ;POINT PZ TO COLUMN COUNTER
     770/     3E2 : D7                          SEP R7
     770/     3E3 : 1A                          db (TTYCC-1)&255
     771/     3E4 : 8A                             GLO     AC        ;GET # OF PADS TO GO
     772/     3E5 : FE                             SHL               ;MSB SELECTS NULL OR DELETE
     773/     3E6 : 32 EF                          BZ      PLF       ;UNTIL NO MORE PADS..
     774/     3E8 : 2A                             DEC     AC        ;DECREMENT # OF PADS TO GO
     775/     3E9 : (MACRO)                        LDI0              ;PAD=NULL=0 IF MSB=0
     775/     3E9 : 9D                          GHI RD 
     776/     3EA : C7                             LSNF
     777/     3EB : F8 FF                          LDI     0FFh      ;PAD=DELETE=FFH IF MSB=1
     778/     3ED : 30 DF                          BR      PADS      ;..REPEAT
     779/     3EF :                     ;
     780/     3EF : 73                  PLF        STXD              ;SET COLUMN COUNTER TTYCC=0
     781/     3F0 : F8 8A                          LDI     08Ah      ;TYPE <LF>
     782/     3F2 :                     ;
     783/     3F2 : FF 80                          SMI     080h      ;FIX HI BIT
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 16 - 09/30/24 17:27:32


     784/     3F4 : BF                  TYPER      PHI     X         ;SAVE CHAR
     785/     3F5 : (MACRO)                        FETCH   TTYCC ;CHECK OUTPUT MODE
     785/     3F5 : D7                          SEP R7
     785/     3F6 : 1B                          db (TTYCC)&255
     786/     3F7 : 2D                             DEC     PZ
     787/     3F8 : FC 81                          ADI     081h      ;INCREMENT COLUMN COUNTER TTYCC
     788/     3FA : FC 80                          ADI     080h      ;WITHOUT DISTURBING MSB
     789/     3FC : 3B 66                          BNF     SEP5      ;IF MSB=1, IN TAPE MODE, NOT PRINTIN
     790/     3FE : 5D                             STR     PZ        ;ELSE UPDATE COLUMN COUNTER
     791/     3FF : 9F                             GHI     X         ;GET CHAR
     792/     400 : C0 01 09                       LBR     TYPEV     ;AND GO TYPE IT
     793/     403 :                     ;
     794/     403 : F8 20               TAB        LDI     020h
     795/     405 : (MACRO)                        CALL    TYPER
     795/     405 : D4                          SEP R4
     795/     406 : 03 F4                       dw TYPER
     796/     408 : (MACRO)                        FETCH   TTYCC ;GET COLUMN COUNT
     796/     408 : D7                          SEP R7
     796/     409 : 1B                          db (TTYCC)&255
     797/     40A : FA 07               TABS       ANI     7          ;LOW 3 BITS
     798/     40C : 3A 03                          BNZ     TAB
     799/     40E : (MACRO)                        RETURN
     799/     40E : D5                          SEP R5
     800/     40F : (MACRO)                        CALL    TYPER
     800/     40F : D4                          SEP R4
     800/     410 : 03 F4                       dw TYPER
     801/     412 : 2A                             DEC     AC        ;DECREMENT SPACES TO GO
     802/     413 : 30 0A                          BR      TABS      ;...REPEAT
     803/     415 :                     ;
     804/     415 : (MACRO)             PRNA       CALL    APUSH     ;NUMBER IN AC
     804/     415 : D4                          SEP R4
     804/     416 : 03 54                       dw APUSH
     805/     418 : (MACRO)             PRN        FETCH   AEPTR ;CHECK SIGN
     805/     418 : D7                          SEP R7
     805/     419 : 1A                          db (AEPTR)&255
     806/     41A : AD                             PLO     PZ
     807/     41B : (MACRO)                        CALL    DNEG      ;IF NEGATIVE,
     807/     41B : D4                          SEP R4
     807/     41C : 05 13                       dw DNEG
     808/     41E : 3B 25                          BNF     PRP
     809/     420 : F8 2D                          LDI     '-'       ;PRINT '-'
     810/     422 : (MACRO)                        CALL    TYPER
     810/     422 : D4                          SEP R4
     810/     423 : 03 F4                       dw TYPER
     811/     425 : (MACRO)             PRP        LDI0              ;PUSH ZERO FLAG
     811/     425 : 9D                          GHI RD 
     812/     426 : 73                             STXD              ;WHICH ;MARKS NUMBER END
     813/     427 : BA                             PHI     AC        ;PUSh, 010h  (=DIVISOR)
     814/     428 : F8 0A                          LDI     10
     815/     42A : (MACRO)                        CALL    APUSH+1
     815/     42A : D4                          SEP R4
     815/     42B : 03 55                       dw APUSH+1
     816/     42D : 1D                             INC     PZ
     817/     42E : (MACRO)             PDVL       CALL    PDIV      ;DIVIDE BY 10
     817/     42E : D4                          SEP R4
     817/     42F : 04 E3                       dw PDIV
     818/     431 : 8A                             GLO     AC        ;REMAINDER IS NEXT DIGIT
     819/     432 : F6                             SHR               ;BUT ;DOUBLED; HALVE IT
     820/     433 : F9 30                          ORI     030h      ;CONVERT TO ASCII
     821/     435 : 73                             STXD              ;PUSH ;IT
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 17 - 09/30/24 17:27:32


     822/     436 : 1D                             INC     PZ        ;IS QUOTIENT=0?
     823/     437 : 4D                             LDA     PZ
     824/     438 : ED                             SEX     PZ
     825/     439 : F1                             OR
     826/     43A : 2D                             DEC     PZ        ;RESTORE POINTER
     827/     43B : 2D                             DEC     PZ
     828/     43C : 3A 2E                          BNZ     PDVL      ;..REPEAT
     829/     43E : 12                  PRNL       INC     R2        ;NOW, TO PRINT IT
     830/     43F : 02                             LDN     R2        ;GET CHAR
     831/     440 : C2 02 C2                       LBZ     APOP-3    ;UNTIL ZERO (END FLAG)..
     832/     443 : (MACRO)                        CALL    TYPER     ;PRINT IT
     832/     443 : D4                          SEP R4
     832/     444 : 03 F4                       dw TYPER
     833/     446 : 30 3E                          BR      PRNL      ;..REPEAT
     834/     448 :                     ;
     835/     448 : (MACRO)             RSBP       FETCH   SP        ;GET SP
     835/     448 : D7                          SEP R7
     835/     449 : 2E                          db (SP)&255
     836/     44A : 38                             SKP
     837/     44B : 9B                  SVBP       GHI     BP        ;GET BP
     838/     44C : FB 00                          XRI     (LINE)>>8 ;IN THE LINE?
     839/     44E : 3A 5E                          BNZ     SWAP      ;NO, NOT IN SAME PAGE
     840/     450 : 8B                             GLO     BP
     841/     451 : 52                             STR     R2
     842/     452 : F0                             LDX
     843/     453 : FF 80                          SMI     (AESTK)&255
     844/     455 : 33 5E                          BDF     SWAP      ;NO, BEYOND ITS END
     845/     457 : (MACRO)                        FETCH   SP
     845/     457 : D7                          SEP R7
     845/     458 : 2E                          db (SP)&255
     846/     459 : 8B                             GLO     BP        ;YES, JUST COPY BP TO SP
     847/     45A : 73                             STXD
     848/     45B : 9B                             GHI     BP
     849/     45C : 5D                             STR     PZ
     850/     45D : (MACRO)             TYX        RETURN
     850/     45D : D5                          SEP R5
     851/     45E :                     ;
     852/     45E : (MACRO)             SWAP       FETCH   SP        ;EXCHANGE BP AND SP
     852/     45E : D7                          SEP R7
     852/     45F : 2E                          db (SP)&255
     853/     460 : B8                             PHI     XX        ;PUT SP IN TEMP
     854/     461 : 0D                             LDN     PZ
     855/     462 : A8                             PLO     XX
     856/     463 : 8B                             GLO     BP        ;STORE BP IN SP
     857/     464 : 73                             STXD
     858/     465 : 9B                             GHI     BP
     859/     466 : 5D                             STR     PZ
     860/     467 : 98                             GHI     XX        ;STORE TEMP IN BP
     861/     468 : BB                             PHI     BP
     862/     469 : 88                             GLO     XX
     863/     46A : AB                             PLO     BP
     864/     46B : (MACRO)                        RETURN
     864/     46B : D5                          SEP R5
     865/     46C :                     ;
     866/     46C : (MACRO)             CMPR       CALL    APOP      ;GET FIRST NUMBER
     866/     46C : D4                          SEP R4
     866/     46D : 02 C5                       dw APOP
     867/     46F : 9A                             GHI     AC        ;PUSH ONTO STACK WITH BIAS
     868/     470 : FB 80                          XRI     080h      ;(FOR 2'S COMPLEMENT)
     869/     472 : 73                             STXD              ;(BACKWARDS)
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 18 - 09/30/24 17:27:32


     870/     473 : 8A                             GLO     AC
     871/     474 : 73                             STXD
     872/     475 : (MACRO)                        CALL    BPOP      ;GET AND SAVE
     872/     475 : D4                          SEP R4
     872/     476 : 02 C9                       dw BPOP
     873/     478 : AF                             PLO     X         ;COMPARE BITS
     874/     479 : (MACRO)                        CALL    APOP      ;GET SECOND NUMBER
     874/     479 : D4                          SEP R4
     874/     47A : 02 C5                       dw APOP
     875/     47C : 12                             INC     R2
     876/     47D : 8A                             GLO     AC        ;COMARE THEM
     877/     47E : F7                             SM                ;LOW BYTE
     878/     47F : AA                             PLO     AC
     879/     480 : 12                             INC     R2
     880/     481 : 9A                             GHI     AC        ;HIGH BYTE
     881/     482 : FB 80                          XRI     080h      ;BIAS: 0 TO 65535 INSTEAD
     882/     484 : 77                             SMB               ;OF -32768 TO +32767
     883/     485 : 52                             STR     R2
     884/     486 : 3B 92                          BNF     CLT       ;LESS IF NO CARRY OUT
     885/     488 : 8A                             GLO     AC
     886/     489 : F1                             OR
     887/     48A : 32 8F                          BZ      CEQ       ;EQUAL IF BOTH BYTES 0
     888/     48C : 8F                             GLO     X         ;ELSE GREATER
     889/     48D : F6                             SHR               ;MOVE PROPER BIT
     890/     48E : 38                             SKP
     891/     48F : 8F                  CEQ        GLO     X         ;(BIT 1)
     892/     490 : F6                             SHR
     893/     491 : 38                             SKP
     894/     492 : 8F                  CLT        GLO     X         ;(BIT 0)
     895/     493 : F6                             SHR               ;TO CARRY
     896/     494 : C7                             LSNF
     897/     495 : C4                             NOP
     898/     496 : 19                  SKIP       INC     PC        ;SKIP ONE BYTE IF TRUE
     899/     497 : (MACRO)                        RETURN
     899/     497 : D5                          SEP R5
     900/     498 :                     ;
     901/     498 : (MACRO)             ISUB       CALL    INEG      ;SUBTRACT IS ADD NEGATIVE
     901/     498 : D4                          SEP R4
     901/     499 : 05 0E                       dw INEG
     902/     49B : (MACRO)             IADD       CALL    APOP      ;PUT ADDEND IN AC
     902/     49B : D4                          SEP R4
     902/     49C : 02 C5                       dw APOP
     903/     49E : ED                             SEX     PZ
     904/     49F : 1D                             INC     PZ        ;ADD TO AUGEND
     905/     4A0 : 8A                             GLO     AC
     906/     4A1 : F4                             ADD
     907/     4A2 : 73                             STXD
     908/     4A3 : 9A                             GHI     AC        ;CARRY INTO HIGH BYTE
     909/     4A4 : 74                             ADC
     910/     4A5 : 5D                             STR     PZ
     911/     4A6 : (MACRO)                        RETURN
     911/     4A6 : D5                          SEP R5
     912/     4A7 :                     ;
     913/     4A7 : (MACRO)             IMUL       CALL    APOP      ;MULTIPLIER IN AC
     913/     4A7 : D4                          SEP R4
     913/     4A8 : 02 C5                       dw APOP
     914/     4AA : F8 10                          LDI     010h      ;BIT COUNTER IN X
     915/     4AC : AF                             PLO     X
     916/     4AD : 4D                             LDA     PZ        ;MULTIPLICAND IN XX
     917/     4AE : B8                             PHI     XX
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 19 - 09/30/24 17:27:32


     918/     4AF : 0D                             LDN     PZ
     919/     4B0 : A8                             PLO     XX
     920/     4B1 : 0D                  MULL       LDN     PZ        ;SHIFT PRODUCT LEFT
     921/     4B2 : FE                             SHL               ;(ON STACK)
     922/     4B3 : 5D                             STR     PZ
     923/     4B4 : 2D                             DEC     PZ
     924/     4B5 : 0D                             LDN     PZ
     925/     4B6 : 7E                             SHLC              ;DISCARD HIGh, 016h  BITS
     926/     4B7 : 5D                             STR     PZ
     927/     4B8 : (MACRO)                        CALL    SHAL      ;GET A BIT
     927/     4B8 : D4                          SEP R4
     927/     4B9 : 05 22                       dw SHAL
     928/     4BB : 3B C5                          BNF     MULC      ;NOT THIS TIME
     929/     4BD : ED                             SEX     PZ        ;IF MULTIPLIER BIT=1,
     930/     4BE : 1D                             INC     PZ
     931/     4BF : 88                             GLO     XX        ;ADD MULTIPLICAND
     932/     4C0 : F4                             ADD
     933/     4C1 : 73                             STXD
     934/     4C2 : 98                             GHI     XX
     935/     4C3 : 74                             ADC
     936/     4C4 : 5D                             STR     PZ
     937/     4C5 : 2F                  MULC       DEC     X         ;REPEAT 16 TIMES
     938/     4C6 : 8F                             GLO     X
     939/     4C7 : 1D                             INC     PZ
     940/     4C8 : 3A B1                          BNZ     MULL
     941/     4CA : (MACRO)                        RETURN
     941/     4CA : D5                          SEP R5
     942/     4CB :                     ;
     943/     4CB : (MACRO)             IDIV       CALL    APOP      ;GET DIVISOR
     943/     4CB : D4                          SEP R4
     943/     4CC : 02 C5                       dw APOP
     944/     4CE : 9A                             GHI     AC
     945/     4CF : 52                             STR     R2        ;CHECK FOR DIVIDE BY ZERO
     946/     4D0 : 8A                             GLO     AC
     947/     4D1 : F1                             OR
     948/     4D2 : C2 03 7F                       LBZ     ERR       ;IF YES, FORGET IT
     949/     4D5 : 0D                             LDN     PZ        ;COMPARE SIGN OF DIVISOR
     950/     4D6 : F3                             XOR
     951/     4D7 : 73                             STXD              ;SAVE FOR LATER
     952/     4D8 : (MACRO)                        CALL    DNEG      ;MAKE DIVEDEND POSITIVE
     952/     4D8 : D4                          SEP R4
     952/     4D9 : 05 13                       dw DNEG
     953/     4DB : 2D                             DEC     PZ        ;SAME FOR DIVISOR
     954/     4DC : 2D                             DEC     PZ
     955/     4DD : (MACRO)                        CALL    DNEG
     955/     4DD : D4                          SEP R4
     955/     4DE : 05 13                       dw DNEG
     956/     4E0 : 1D                             INC     PZ
     957/     4E1 : (MACRO)                        LDI0        
     957/     4E1 : 9D                          GHI RD 
     958/     4E2 : C8                             LSKP
     959/     4E3 : (MACRO)             PDIV       LDI0              ;MARK "NO SIGN CHANGE"
     959/     4E3 : 9D                          GHI RD 
     960/     4E4 : 73                             STXD              ;FOR PRN ENTRY
     961/     4E5 : AA                             PLO     AC        ;CLEAR HIGH END
     962/     4E6 : BA                             PHI     AC        ;OF DIVIDEND IN AC
     963/     4E7 : F8 11                          LDI     17        ;COUNTER TO X
     964/     4E9 : AF                             PLO     X
     965/     4EA : ED                  DIVL       SEX     PZ        ;DO TRIAL SUBTRACT
     966/     4EB : 8A                             GLO     AC
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 20 - 09/30/24 17:27:32


     967/     4EC : F7                             SM
     968/     4ED : 52                             STR     R2        ;HOLD LOW BYTE FOR NOW
     969/     4EE : 2D                             DEC     PZ
     970/     4EF : 9A                             GHI     AC
     971/     4F0 : 77                             SMB
     972/     4F1 : 3B F6                          BNF     $+5       ;IF NEGATIVE, CANCEL  IT
     973/     4F3 : BA                             PHI     AC        ;IF POSITIVE, MAKE IT REAL
     974/     4F4 : 02                             LDN     R2
     975/     4F5 : AA                             PLO     AC
     976/     4F6 : 1D                             INC     PZ        ;SHIFT EVERYTHING LEFT
     977/     4F7 : 1D                             INC     PZ
     978/     4F8 : 1D                             INC     PZ
     979/     4F9 : F0                             LDX
     980/     4FA : 7E                             SHLC
     981/     4FB : 73                             STXD
     982/     4FC : F0                             LDX
     983/     4FD : 7E                             SHLC
     984/     4FE : 73                             STXD
     985/     4FF : 8A                             GLO     AC        ;HIGh, 016h 
     986/     500 : 7E                             SHLC
     987/     501 : (MACRO)                        CALL    SHCL
     987/     501 : D4                          SEP R4
     987/     502 : 05 24                       dw SHCL
     988/     504 : 2F                             DEC     X         ;DO IT 16 TIMES MORE
     989/     505 : 8F                             GLO     X
     990/     506 : CA 04 EA                       LBNZ    DIVL
     991/     509 : 12                             INC     R2        ;CHECK SIGN OF QUOTIENT
     992/     50A : 02                             LDN     R2
     993/     50B : FE                             SHL
     994/     50C : 3B 21                          BNF     NEGX      ;POSITIVE IS DONE
     995/     50E : (MACRO)             INEG       FETCH   AEPTR ;POINT TO STACK
     995/     50E : D7                          SEP R7
     995/     50F : 1A                          db (AEPTR)&255
     996/     510 : AD                             PLO     PZ
     997/     511 : 30 18                          BR      NEG
     998/     513 : ED                  DNEG       SEX     PZ
     999/     514 : F0                             LDX               ;FOR DIVIDE,
    1000/     515 : FE                             SHL               ;TEST SIGN
    1001/     516 : 3B 21                          BNF     NEGX      ;IF POSITIVE, LEAVE IT ALONE
    1002/     518 : 1D                  NEG        INC     PZ        ;IF NEGATIVE,
    1003/     519 : (MACRO)                        LDI0              ;SUBTRACT IT FROM 0
    1003/     519 : 9D                          GHI RD 
    1004/     51A : F7                             SM
    1005/     51B : 73                             STXD
    1006/     51C : (MACRO)                        LDI0        
    1006/     51C : 9D                          GHI RD 
    1007/     51D : 77                             SMB
    1008/     51E : 5D                             STR     PZ
    1009/     51F : FF 00                          SMI     0         ;AND SET CARRY=1
    1010/     521 : (MACRO)             NEGX       RETURN
    1010/     521 : D5                          SEP R5
    1011/     522 :                     ;
    1012/     522 : 8A                  SHAL       GLO     AC        ;USED BY MULTIPLY
    1013/     523 : FE                             SHL
    1014/     524 : AA                  SHCL       PLO     AC        ;AND DIVIDE
    1015/     525 : 9A                             GHI     AC
    1016/     526 : 7E                             SHLC
    1017/     527 : BA                             PHI     AC
    1018/     528 : (MACRO)                        RETURN
    1018/     528 : D5                          SEP R5
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 21 - 09/30/24 17:27:32


    1019/     529 :                     ;
    1020/     529 : (MACRO)             NXT        FETCH   XEQ       ;IF DIRECT EXECUTION
    1020/     529 : D7                          SEP R7
    1020/     52A : 18                          db (XEQ)&255
    1021/     52B : C2 03 B1                       LBZ     FIN       ;QUIT WITh, 0DFh =0
    1022/     52E : 4B                             LDA     BP        ;ELSE SCAN TO NEXT <CR>
    1023/     52F : FB 0D                          XRI     00Dh
    1024/     531 : 3A 2E                          BNZ     $-3
    1025/     533 : (MACRO)                        CALL    GLINO     ;GET LINE NUMBER
    1025/     533 : D4                          SEP R4
    1025/     534 : 06 98                       dw GLINO
    1026/     536 : 32 4B                          BZ      BERR      ;ZERO IS ERROR
    1027/     538 : (MACRO)             CONT       CALL    BREAKV    ;TEST FOR BREAK
    1027/     538 : D4                          SEP R4
    1027/     539 : 01 0C                       dw BREAKV
    1028/     53B : 33 46                          BDF     BREAK     ;IF BREAK,
    1029/     53D : (MACRO)                        FETCH   NXA       ;RECOVER RESTART POINT
    1029/     53D : D7                          SEP R7
    1029/     53E : 1C                          db (NXA)&255
    1030/     53F : B9                             PHI     PC        ;WHICH WAS SAVED BY INIT
    1031/     540 : 4D                             LDA     PZ
    1032/     541 : A9                             PLO     PC
    1033/     542 : (MACRO)             RUN        FETCH   XEQ-1 ;TURN OFF RUN MODE
    1033/     542 : D7                          SEP R7
    1033/     543 : 17                          db (XEQ-1)&255
    1034/     544 : 5D                             STR     PZ         ;(NON-ZERO)
    1035/     545 : (MACRO)                        RETURN
    1035/     545 : D5                          SEP R5
    1036/     546 :                     ;
    1037/     546 : (MACRO)             BREAK      FETCH   AIL       ;SET BREAK ADDR=0
    1037/     546 : D7                          SEP R7
    1037/     547 : 1E                          db (AIL)&255
    1038/     548 : B9                             PHI     PC        ;I.E. PC=IL START
    1039/     549 : 4D                             LDA     PZ
    1040/     54A : A9                             PLO     PC
    1041/     54B : C0 03 7F            BERR       LBR     ERR
    1042/     54E :                     ;
    1043/     54E : (MACRO)             XINIT      FETCH   BASIC ;POINT TO START OF BASIC PROGRAM
    1043/     54E : D7                          SEP R7
    1043/     54F : 20                          db (BASIC)&255
    1044/     550 : BB                             PHI     BP
    1045/     551 : 4D                             LDA     PZ
    1046/     552 : AB                             PLO     BP
    1047/     553 : (MACRO)                        CALL    GLINO     ;GET LINE NUMBER
    1047/     553 : D4                          SEP R4
    1047/     554 : 06 98                       dw GLINO
    1048/     556 : 32 4B                          BZ      BERR      ;IF 0, IS ERROR (NO PROGRAM)
    1049/     558 : (MACRO)                        FETCH   NXA       ;SAVE STATEMENT
    1049/     558 : D7                          SEP R7
    1049/     559 : 1C                          db (NXA)&255
    1050/     55A : 89                             GLO     PC        ;ANALYZER ADDRESS
    1051/     55B : 73                             STXD
    1052/     55C : 99                             GHI     PC
    1053/     55D : 5D                             STR     PZ
    1054/     55E : 30 42                          BR      RUN       ;GO START UP
    1055/     560 :                     ;
    1056/     560 : (MACRO)             XFER       CALL    FIND      ;GET THE LINE
    1056/     560 : D4                          SEP R4
    1056/     561 : 05 FE                       dw FIND
    1057/     563 : 32 38                          BZ      CONT      ;IF WE GOT IT, GO CONTINUE
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 22 - 09/30/24 17:27:32


    1058/     565 : (MACRO)             GOAL       FETCH   LINO ;ELSE FAILED
    1058/     565 : D7                          SEP R7
    1058/     566 : 28                          db (LINO)&255
    1059/     567 : 8A                             GLO     AC        ;MARK DESTINATION
    1060/     568 : 73                             STXD
    1061/     569 : 9A                             GHI     AC
    1062/     56A : 5D                             STR     PZ
    1063/     56B : 30 4B                          BR      BERR      ;GO HANDLE ERROR
    1064/     56D :                     ;
    1065/     56D : (MACRO)             RSTR       CALL    TTOP      ;CHECK FOR UNDERFLOW
    1065/     56D : D4                          SEP R4
    1065/     56E : 05 8B                       dw TTOP
    1066/     570 : 42                             LDA     R2        ;GET THE NUMBER
    1067/     571 : BA                             PHI     AC        ;FROM STACK INTO AC
    1068/     572 : 02                             LDN     R2
    1069/     573 : AA                             PLO     AC
    1070/     574 : (MACRO)                        FETCH   TOPS
    1070/     574 : D7                          SEP R7
    1070/     575 : 26                          db (TOPS)&255
    1071/     576 : 82                             GLO     R2        ;RESET TOPS FROM R2
    1072/     577 : 73                             STXD
    1073/     578 : 92                             GHI     R2
    1074/     579 : 73                             STXD
    1075/     57A : (MACRO)                        CALL    FIND+3    ;POINT TO THIS LINE
    1075/     57A : D4                          SEP R4
    1075/     57B : 06 01                       dw FIND+3
    1076/     57D : 3A 65                          BNZ     GOAL      ;NOT THERE ANY MORE
    1077/     57F : 30 88                          BR      BNEXT     ;OK
    1078/     581 :                     ;
    1079/     581 : (MACRO)             RTN        CALL    TTOP      ;CHECK FOR UNDERFLOW
    1079/     581 : D4                          SEP R4
    1079/     582 : 05 8B                       dw TTOP
    1080/     584 : 42                             LDA     R2        ;(2 ALREADY INCLUDED)
    1081/     585 : B9                             PHI     PC        ;PIP ADDRESS TO PC
    1082/     586 : 02                             LDN     R2
    1083/     587 : A9                             PLO     PC
    1084/     588 : C0 02 2D            BNEXT      LBR     NEXT
    1085/     58B :                     ;
    1086/     58B : (MACRO)             TTOP       FETCH   STACK ;GET TOP OF STACK
    1086/     58B : D7                          SEP R7
    1086/     58C : 22                          db (STACK)&255
    1087/     58D : 12                             INC     R2
    1088/     58E : 12                             INC     R2
    1089/     58F : 82                             GLO     R2        ;MATCH TO STACK POINTER
    1090/     590 : FC 02                          ADI     2         ;(ADJUSTED FOR RETURN)
    1091/     592 : F3                             XOR
    1092/     593 : 2D                             DEC     PZ
    1093/     594 : 3A 9C                          BNZ     TTOK      ;NOT EQUAL
    1094/     596 : 92                             GHI     R2
    1095/     597 : 7C 00                          ADCI    0
    1096/     599 : F3                             XOR
    1097/     59A : 32 4B                          BZ      BERR      ;MATCH IS EMPTY STACK
    1098/     59C :                     ;
    1099/     59C : 12                  TTOK       INC     R2        ;(ONCE HERE SAVES TWICE)
    1100/     59D : (MACRO)                        RETURN
    1100/     59D : D5                          SEP R5
    1101/     59E :                     ;
    1102/     59E : (MACRO)             TAPE       FETCH   PAD+1 ;TURN OFF TYPEOUT
    1102/     59E : D7                          SEP R7
    1102/     59F : 16                          db (PAD+1)&255
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 23 - 09/30/24 17:27:32


    1103/     5A0 : 38                             SKP
    1104/     5A1 : (MACRO)             NTAPE      LDI0              ;TURN ON TYPEOUT
    1104/     5A1 : 9D                          GHI RD 
    1105/     5A2 : FE                             SHL               ;(FLAG TO CARRY)
    1106/     5A3 : (MACRO)                        FETCH   TTYCC-1
    1106/     5A3 : D7                          SEP R7
    1106/     5A4 : 1A                          db (TTYCC-1)&255
    1107/     5A5 : (MACRO)                        LDI0        
    1107/     5A5 : 9D                          GHI RD 
    1108/     5A6 : 76                             SHRC              ;00 OR 80H
    1109/     5A7 : 5D                             STR     PZ
    1110/     5A8 : 30 B2                          BR      KLOOP
    1111/     5AA : F8 30               GETLN      LDI     (LINE)&255  ;POINT TO LINE
    1112/     5AC : AB                             PLO     BP
    1113/     5AD : (MACRO)                        CALL    APUSH     ;MARK STACK LIMIT
    1113/     5AD : D4                          SEP R4
    1113/     5AE : 03 54                       dw APUSH
    1114/     5B0 : 9D                             GHI     PZ
    1115/     5B1 : BB                             PHI     BP
    1116/     5B2 : (MACRO)             KLOOP      CALL    KEYV      ;GET AN ECHOED BYTE
    1116/     5B2 : D4                          SEP R4
    1116/     5B3 : 01 06                       dw KEYV
    1117/     5B5 : FA 7F                          ANI     7FH       ;SET HIGH BIT TO 0
    1118/     5B7 : 32 B2                          BZ      KLOOP     ;IGNORE NULL
    1119/     5B9 : 52                             STR     R2
    1120/     5BA : FB 7F                          XRI     07Fh
    1121/     5BC : 32 B2                          BZ      KLOOP     ;IGNORE DELETE
    1122/     5BE : FB 75                          XRI     075h      ;IF <LF>,
    1123/     5C0 : 32 9E                          BZ      TAPE      ;THEN TURN TAPE MODE ON
    1124/     5C2 : FB 19                          XRI     019h      ;IF <XOFF> (DC3=13H),
    1125/     5C4 : 32 A1                          BZ      NTAPE     ;THEN TURN TAPE MODE OFF
    1126/     5C6 : (MACRO)                        FETCH   CAN-1
    1126/     5C6 : D7                          SEP R7
    1126/     5C7 : 13                          db (CAN-1)&255
    1127/     5C8 : 02                             LDN     R2
    1128/     5C9 : F3                             XOR               ;IF CANCEL,
    1129/     5CA : 32 D7                          BZ      CANCL     ;THEN GO TO CANCEL
    1130/     5CC : 2D                             DEC     PZ
    1131/     5CD : 02                             LDN     R2
    1132/     5CE : F3                             XOR
    1133/     5CF : 3A DD                          BNZ     STOK      ;NO
    1134/     5D1 : 2B                             DEC     BP        ;YES
    1135/     5D2 : 8B                             GLO     BP
    1136/     5D3 : FF 30                          SMI     (LINE)&255  ;ANYTHING LEFT?
    1137/     5D5 : 33 B2                          BDF     KLOOP       ;YES
    1138/     5D7 : F8 30               CANCL      LDI     (LINE)&255  ;IF NO, CANCEL THIS LINE
    1139/     5D9 : AB                             PLO     BP
    1140/     5DA : F8 0D                          LDI     00Dh      ;BY FORCING A <CR>
    1141/     5DC : 38                             SKP
    1142/     5DD : 02                  STOK       LDN     R2        ;STORE CHARACTER IN LINE
    1143/     5DE : 5B                             STR     BP
    1144/     5DF : (MACRO)                        FETCH   AEPTR-1
    1144/     5DF : D7                          SEP R7
    1144/     5E0 : 19                          db (AEPTR-1)&255
    1145/     5E1 : 8B                             GLO     BP        ;CHECK FOR OVERFLOW
    1146/     5E2 : F7                             SM
    1147/     5E3 : 3B EC                          BNF     CHIN      ;OK
    1148/     5E5 : F8 07                          LDI     7         ;IF NOT, RING BELL
    1149/     5E7 : (MACRO)                        CALL    TYPER
    1149/     5E7 : D4                          SEP R4
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 24 - 09/30/24 17:27:32


    1149/     5E8 : 03 F4                       dw TYPER
    1150/     5EA : 0B                             LDN     BP        ;NOW LOOK AT CHAR
    1151/     5EB : 38                             SKP
    1152/     5EC : 4B                  CHIN       LDA     BP        ;INCREMENT POINTER
    1153/     5ED : FB 0D                          XRI     00Dh      ;IF NOT <CR>,
    1154/     5EF : 3A B2                          BNZ     KLOOP     ;THEN GET ANOTHER
    1155/     5F1 : (MACRO)                        CALL    CRLF      ;ELSE ECHO <LF>
    1155/     5F1 : D4                          SEP R4
    1155/     5F2 : 03 D5                       dw CRLF
    1156/     5F4 : (MACRO)                        FETCH   LEND-1 ;AND MARK END
    1156/     5F4 : D7                          SEP R7
    1156/     5F5 : 18                          db (LEND-1)&255
    1157/     5F6 : 8B                             GLO     BP
    1158/     5F7 : 5D                             STR     PZ
    1159/     5F8 : F8 30                          LDI     (LINE)&255  ;RESET BP TO FRONT
    1160/     5FA : AB                             PLO     BP
    1161/     5FB : C0 02 C5                       LBR     APOP      ;AND GO POP DUMMY
    1162/     5FE :                     ;
    1163/     5FE : (MACRO)             FIND       CALL    APOP      ;GET LINE NUMBER
    1163/     5FE : D4                          SEP R4
    1163/     5FF : 02 C5                       dw APOP
    1164/     601 : 8A                             GLO     AC
    1165/     602 : 52                             STR     R2        ;CHECK FOR ZERO
    1166/     603 : 9A                             GHI     AC
    1167/     604 : F1                             OR
    1168/     605 : C2 03 7F                       LBZ     ERR       ;IF 0, GO TO ERROR
    1169/     608 : (MACRO)             FINDX      FETCH   BASIC ;START AT FRONT
    1169/     608 : D7                          SEP R7
    1169/     609 : 20                          db (BASIC)&255
    1170/     60A : BB                             PHI     BP
    1171/     60B : 4D                             LDA     PZ
    1172/     60C : AB                             PLO     BP
    1173/     60D : (MACRO)             FLINE      CALL    GLINO     ;GET LINE NUMBER
    1173/     60D : D4                          SEP R4
    1173/     60E : 06 98                       dw GLINO
    1174/     610 : C6                             LSNZ              ;NOT THER IF 0
    1175/     611 : 8D                             GLO     PZ        ;SET NON-ZERO,
    1176/     612 : (MACRO)             FEND       RETURN            ;AND RETURN
    1176/     612 : D5                          SEP R5
    1177/     613 : ED                             SEX     PZ
    1178/     614 : 8A                             GLO     AC        ;COMPARE THEM
    1179/     615 : F5                             SD
    1180/     616 : 52                             STR     R2        ;(SAVE LOW BYTE OF DIFFERENCE)
    1181/     617 : 9A                             GHI     AC
    1182/     618 : 2D                             DEC     PZ
    1183/     619 : 75                             SDB
    1184/     61A : E2                             SEX     R2
    1185/     61B : F1                             OR                ;(D=0 IF EQUAL)
    1186/     61C : 33 12                          BDF     FEND      ;LESS OR EQUAL IS END
    1187/     61E : 4B                             LDA     BP        ;NOT THERE YET
    1188/     61F : FB 0D                          XRI     00Dh      ;SCAN TO NEXT <CR>
    1189/     621 : 3A 1E                          BNZ     $-3
    1190/     623 : 30 0D                          BR      FLINE
    1191/     625 :                     ;
    1192/     625 : (MACRO)             HOOP       CALL    HOOP+3    ;ADJUST STACK
    1192/     625 : D4                          SEP R4
    1192/     626 : 06 28                       dw HOOP+3
    1193/     628 : (MACRO)                        CALL    APOP      ;SET UP PARAMETERS:
    1193/     628 : D4                          SEP R4
    1193/     629 : 02 C5                       dw APOP
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 25 - 09/30/24 17:27:32


    1194/     62B : 4D                             LDA     PZ        ;AC
    1195/     62C : B8                             PHI     XX        ;MIDDLE ARGUMENT TO XX
    1196/     62D : 4D                             LDA     PZ
    1197/     62E : A8                             PLO     XX
    1198/     62F : 4D                             LDA     PZ        ;SUBROUTINE ADDRESS BECOMES
    1199/     630 : B6                             PHI     R6        ;"RETURN ADDRESS"
    1200/     631 : 4D                             LDA     PZ
    1201/     632 : A6                             PLO     R6
    1202/     633 : 8D                             GLO     PZ        ;FIX STACK POINTER
    1203/     634 : 52                             STR     R2
    1204/     635 : (MACRO)                        FETCH   AEPTR-1
    1204/     635 : D7                          SEP R7
    1204/     636 : 19                          db (AEPTR-1)&255
    1205/     637 : 02                             LDN     R2        ;BY PUTTING CURRENT VALUE
    1206/     638 : 5D                             STR     PZ        ;VALUE BACK INTO IT
    1207/     639 : AD                             PLO     PZ        ;LEAVE PZ AT STACK TOP
    1208/     63A : 8A                             GLO     AC        ;LEAVE AC.0 IN D
    1209/     63B : (MACRO)                        RETURN              GO ;DO IT
    1209/     63B : D5                          SEP R5
    1210/     63C :                     ;
    1211/     63C : (MACRO)             LIST       FETCH   WORK+2
    1211/     63C : D7                          SEP R7
    1211/     63D : 2C                          db (WORK+2)&255
    1212/     63E : 8B                             GLO     BP        ;SAVE POINTERS
    1213/     63F : 73                             STXD
    1214/     640 : 9B                             GHI     BP
    1215/     641 : 5D                             STR     PZ
    1216/     642 : (MACRO)                        CALL    FIND      ;GET LIST LIMITS
    1216/     642 : D4                          SEP R4
    1216/     643 : 05 FE                       dw FIND
    1217/     645 : (MACRO)                        FETCH   WORK ;SAVE UPPER
    1217/     645 : D7                          SEP R7
    1217/     646 : 2A                          db (WORK)&255
    1218/     647 : 8B                             GLO     BP
    1219/     648 : 73                             STXD
    1220/     649 : 9B                             GHI     BP
    1221/     64A : 73                             STXD
    1222/     64B : (MACRO)                        CALL    FIND      ;TWO ITEMS MARK BOUNDS
    1222/     64B : D4                          SEP R4
    1222/     64C : 05 FE                       dw FIND
    1223/     64E : 2B                             DEC     BP        ;BACK UP OVER LINE#
    1224/     64F : 2B                             DEC     BP
    1225/     650 : (MACRO)             LLINE      FETCH   WORK ;END?
    1225/     650 : D7                          SEP R7
    1225/     651 : 2A                          db (WORK)&255
    1226/     652 : 8B                             GLO     BP
    1227/     653 : F7                             SM
    1228/     654 : 2D                             DEC     PZ
    1229/     655 : 9B                             GHI     BP
    1230/     656 : 77                             SMB
    1231/     657 : 33 7B                          BDF     LIX       ;SO IF BP>BOUNDS,
    1232/     659 : 4B                             LDA     BP        ;GET LINE#
    1233/     65A : BA                             PHI     AC
    1234/     65B : 4B                             LDA     BP
    1235/     65C : AA                             PLO     AC
    1236/     65D : 3A 62                          BNZ     $+5
    1237/     65F : 9A                             GHI     AC
    1238/     660 : 32 7B                          BZ      LIX       ;QUIT IF ZERO (PROGRAM END)
    1239/     662 : (MACRO)                        CALL    PRNA      ;ELSE PRINT LINE#
    1239/     662 : D4                          SEP R4
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 26 - 09/30/24 17:27:32


    1239/     663 : 04 15                       dw PRNA
    1240/     665 : F8 2D                          LDI     02Dh      ;THEN A SPACE
    1241/     667 : FB 0D               LLOOP      XRI     00Dh      ;(RESTORE BITS FROM <CR> TEST)
    1242/     669 : (MACRO)                        CALL    TYPER
    1242/     669 : D4                          SEP R4
    1242/     66A : 03 F4                       dw TYPER
    1243/     66C : (MACRO)                        CALL    BREAKV    ;TEST FOR BREAK
    1243/     66C : D4                          SEP R4
    1243/     66D : 01 0C                       dw BREAKV
    1244/     66F : 33 7B                          BDF     LIX       ;IF YES, THEN QUIT
    1245/     671 : 4B                             LDA     BP        ;NOW PRINT TEXT
    1246/     672 : FB 0D                          XRI     00Dh      ;UNTIL <CR>
    1247/     674 : 3A 67                          BNZ     LLOOP
    1248/     676 : (MACRO)                        CALL    CRLF      ;END LINE WITH <CR><LF>
    1248/     676 : D4                          SEP R4
    1248/     677 : 03 D5                       dw CRLF
    1249/     679 : 30 50                          BR      LLINE     ;..REPEAT UNTIL DONE
    1250/     67B :                     ;
    1251/     67B : (MACRO)             LIX        FETCH   WORK+2 ;RESTORE BP
    1251/     67B : D7                          SEP R7
    1251/     67C : 2C                          db (WORK+2)&255
    1252/     67D : BB                             PHI     BP
    1253/     67E : 4D                             LDA     PZ
    1254/     67F : AB                             PLO     BP
    1255/     680 : (MACRO)                        RETURN
    1255/     680 : D5                          SEP R5
    1256/     681 :                     ;
    1257/     681 : (MACRO)             SAV        FETCH   TOPS ;ADJUST STACK TOP
    1257/     681 : D7                          SEP R7
    1257/     682 : 26                          db (TOPS)&255
    1258/     683 : 82                             GLO     R2
    1259/     684 : 73                             STXD
    1260/     685 : 92                             GHI     R2
    1261/     686 : 5D                             STR     PZ
    1262/     687 : (MACRO)                        FETCH   XEQ       ;IF NOT EXECUTING
    1262/     687 : D7                          SEP R7
    1262/     688 : 18                          db (XEQ)&255
    1263/     689 : 2D                             DEC     PZ
    1264/     68A : CE                             LSZ               ;USE ZERO INSTEAD
    1265/     68B : (MACRO)                        FETCH   LINO
    1265/     68B : D7                          SEP R7
    1265/     68C : 28                          db (LINO)&255
    1266/     68D : AA                             PLO     AC        ;HOLD HIGH BYTE
    1267/     68E : 4D                             LDA     PZ        ;GET LOW BYTE
    1268/     68F : 12                             INC     R2
    1269/     690 : 12                             INC     R2
    1270/     691 : E2                             SEX     R2
    1271/     692 : 73                             STXD              ;PUSH ONTO STACK
    1272/     693 : 8A                             GLO     AC        ;NOW THE HIGH BYTE
    1273/     694 : 73                             STXD
    1274/     695 : C0 02 2D                       LBR     NEXT
    1275/     698 :                     ;
    1276/     698 : (MACRO)             GLINO      FETCH   LINO-1 ;SETUP POINTER
    1276/     698 : D7                          SEP R7
    1276/     699 : 27                          db (LINO-1)&255
    1277/     69A : 4B                             LDA     BP        ;GET 1ST BYTE
    1278/     69B : 5D                             STR     PZ        ;STORE IN RAM
    1279/     69C : 1D                             INC     PZ
    1280/     69D : 4B                             LDA     BP        ;2ND BYTE
    1281/     69E : 73                             STXD
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 27 - 09/30/24 17:27:32


    1282/     69F : F1                             OR                ;D=0 IF LINE#=0
    1283/     6A0 : 1D                             INC     PZ
    1284/     6A1 : (MACRO)                        RETURN
    1284/     6A1 : D5                          SEP R5
    1285/     6A2 :                     ;
    1286/     6A2 : (MACRO)             INSRT      CALL    SWAP      ;SAVE POINTER IN NEW LINE
    1286/     6A2 : D4                          SEP R4
    1286/     6A3 : 04 5E                       dw SWAP
    1287/     6A5 : (MACRO)                        CALL    FIND      ;FIND INSERT POINT
    1287/     6A5 : D4                          SEP R4
    1287/     6A6 : 05 FE                       dw FIND
    1288/     6A8 : FC FF                          ADI     0FFh      ;IF DONE, SET DF
    1289/     6AA : (MACRO)                        LDI0        
    1289/     6AA : 9D                          GHI RD 
    1290/     6AB : AF                             PLO     X         ;X IS SIZE DIFFERENCE
    1291/     6AC : 33 BA                          BDF     NEW
    1292/     6AE : 9B                             GHI     BP        ;SAVE INSERT POINT
    1293/     6AF : BD                             PHI     PZ
    1294/     6B0 : 8B                             GLO     BP
    1295/     6B1 : AD                             PLO     PZ
    1296/     6B2 : 2F                             DEC     X         ;MEASURE OLD LINE LENGTH
    1297/     6B3 : 2F                             DEC     X         ;-3 FOR LINE# AND <CR>
    1298/     6B4 : 2F                             DEC     X         ;REPEAT..
    1299/     6B5 : 4D                             LDA     PZ        ;-1 FOR EACH BYTE OF TEXT
    1300/     6B6 : FB 0D                          XRI     00Dh      ;..UNTIL <CR>
    1301/     6B8 : 3A B4                          BNZ     $-4
    1302/     6BA : 2B                  NEW        DEC     BP        ;BACK OVER LINE#
    1303/     6BB : 2B                             DEC     BP
    1304/     6BC : (MACRO)                        CALL    SWAP      ;TRADE LINE POINTERS
    1304/     6BC : D4                          SEP R4
    1304/     6BD : 04 5E                       dw SWAP
    1305/     6BF : (MACRO)                        FETCH   LINO
    1305/     6BF : D7                          SEP R7
    1305/     6C0 : 28                          db (LINO)&255
    1306/     6C1 : 0B                             LDN     BP
    1307/     6C2 : FB 0D                          XRI     00Dh      ;IF NEW LINE IS NULL,
    1308/     6C4 : 73                             STXD
    1309/     6C5 : 5D                             STR     PZ
    1310/     6C6 : 32 D9                          BZ      HMUCH     ;THEN GO MARK IT
    1311/     6C8 : 9A                             GHI     AC        ;ELSE SAVE LINE NUMBER
    1312/     6C9 : 5D                             STR     PZ
    1313/     6CA : 1D                             INC     PZ
    1314/     6CB : 8A                             GLO     AC
    1315/     6CC : 5D                             STR     PZ
    1316/     6CD : 9B                             GHI     BP        ;MEASURE ITS LENGTH
    1317/     6CE : BA                             PHI     AC
    1318/     6CF : 8B                             GLO     BP
    1319/     6D0 : AA                             PLO     AC
    1320/     6D1 : 1F                             INC     X         ;LINE#
    1321/     6D2 : 1F                             INC     X         ;ENDING <CR>
    1322/     6D3 : 1F                             INC     X
    1323/     6D4 : 4A                             LDA     AC
    1324/     6D5 : FB 0D                          XRI     00Dh      ;AND ALL CHARS UNTIL FINAL <CR>
    1325/     6D7 : 3A D3                          BNZ     $-4
    1326/     6D9 : (MACRO)             HMUCH      FETCH   SP        ;FIGURE AMOUNT OF MOVE
    1326/     6D9 : D7                          SEP R7
    1326/     6DA : 2E                          db (SP)&255
    1327/     6DB : BA                             PHI     AC
    1328/     6DC : 4D                             LDA     PZ
    1329/     6DD : AA                             PLO     AC
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 28 - 09/30/24 17:27:32


    1330/     6DE : (MACRO)                        FETCH   MEND ;=DISTANCE FROM INSERT
    1330/     6DE : D7                          SEP R7
    1330/     6DF : 24                          db (MEND)&255
    1331/     6E0 : 8A                             GLO     AC        ;TO END OF PROGRAM
    1332/     6E1 : F7                             SM
    1333/     6E2 : AA                             PLO     AC        ;LEAVE IT IN AC, NEGATIVE
    1334/     6E3 : 2D                             DEC     PZ
    1335/     6E4 : 9A                             GHI     AC
    1336/     6E5 : 77                             SMB
    1337/     6E6 : BA                             PHI     AC
    1338/     6E7 : 1D                             INC     PZ
    1339/     6E8 : 8F                             GLO     X         ;NOW COMPUTE NEW MEND,
    1340/     6E9 : F4                             ADD               ;WHICH IS SUM OF OFFSET,
    1341/     6EA : BF                             PHI     X
    1342/     6EB : 8F                             GLO     X
    1343/     6EC : FA 80                          ANI     080h      ;WITH SIGN EXTEND,
    1344/     6EE : CE                             LSZ
    1345/     6EF : F8 FF                          LDI     0FFh
    1346/     6F1 : 2D                             DEC     PZ
    1347/     6F2 : 74                             ADC               ;PLUS OLD MEND
    1348/     6F3 : E2                             SEX     R2
    1349/     6F4 : 73                             STXD              ;PUSH ONTO STACK
    1350/     6F5 : B8                             PHI     XX
    1351/     6F6 : 9F                             GHI     X
    1352/     6F7 : 73                             STXD              ;(BACKWARDS)
    1353/     6F8 : 52                             STR     R2        ;CHECK FOR OVERFLOW
    1354/     6F9 : 82                             GLO     R2
    1355/     6FA : F5                             SD
    1356/     6FB : 98                             GHI     XX
    1357/     6FC : 52                             STR     R2
    1358/     6FD : 92                             GHI     R2
    1359/     6FE : 75                             SDB
    1360/     6FF : C3 03 7E                       LBDF    ERR-1     ;IF YES, THEN QUIT
    1361/     702 : 8F                             GLO     X         ;ELSE NO, PREPARE TO MOVE
    1362/     703 : 32 30                          BZ      STUFF     ;NO MOVE NEEDED
    1363/     705 : 52                             STR     R2
    1364/     706 : FE                             SHL
    1365/     707 : 3B 1E                          BNF     MORE      ;ADD SOME SPACE
    1366/     709 : (MACRO)                        FETCH   SP        ;DELETE SOME
    1366/     709 : D7                          SEP R7
    1366/     70A : 2E                          db (SP)&255
    1367/     70B : BF                             PHI     X         ;X IS DESTINATION
    1368/     70C : 4D                             LDA     PZ
    1369/     70D : AF                             PLO     X
    1370/     70E : E2                             SEX     R2
    1371/     70F : F7                             SM
    1372/     710 : A8                             PLO     XX        ;XX IS SOURCE
    1373/     711 : 9F                             GHI     X
    1374/     712 : 7C 00                          ADCI    0
    1375/     714 : B8                             PHI     XX
    1376/     715 : 48                             LDA     XX        ;NOW MOVE IT
    1377/     716 : 5F                             STR     X
    1378/     717 : 1F                             INC     X
    1379/     718 : 1A                             INC     AC
    1380/     719 : 9A                             GHI     AC
    1381/     71A : 3A 15                          BNZ     $-5
    1382/     71C : 30 30                          BR      STUFF
    1383/     71E : 9F                  MORE       GHI     X         ;SET UP POINTERS
    1384/     71F : AF                             PLO     X         ;X IS DESTINATION
    1385/     720 : 98                             GHI     XX
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 29 - 09/30/24 17:27:32


    1386/     721 : BF                             PHI     X
    1387/     722 : (MACRO)                        FETCH   MEND
    1387/     722 : D7                          SEP R7
    1387/     723 : 24                          db (MEND)&255
    1388/     724 : B8                             PHI     XX
    1389/     725 : 4D                             LDA     PZ
    1390/     726 : A8                             PLO     XX        ;XX IS SOURCE
    1391/     727 : 2A                             DEC     AC
    1392/     728 : EF                             SEX     X         ;NOW MOVE IT
    1393/     729 : 08                             LDN     XX
    1394/     72A : 28                             DEC     XX
    1395/     72B : 73                             STXD
    1396/     72C : 1A                             INC     AC
    1397/     72D : 9A                             GHI     AC
    1398/     72E : 3A 29                          BNZ     $-5
    1399/     730 : (MACRO)             STUFF      FETCH   MEND ;UPDATE MEND
    1399/     730 : D7                          SEP R7
    1399/     731 : 24                          db (MEND)&255
    1400/     732 : 12                             INC     R2
    1401/     733 : 42                             LDA     R2
    1402/     734 : 73                             STXD
    1403/     735 : 02                             LDN     R2
    1404/     736 : 5D                             STR     PZ
    1405/     737 : (MACRO)                        FETCH   SP        ;POINT INTO PROGRAM
    1405/     737 : D7                          SEP R7
    1405/     738 : 2E                          db (SP)&255
    1406/     739 : BA                             PHI     AC
    1407/     73A : 4D                             LDA     PZ
    1408/     73B : AA                             PLO     AC
    1409/     73C : (MACRO)                        FETCH   LINO ;INSERT NEW LINE
    1409/     73C : D7                          SEP R7
    1409/     73D : 28                          db (LINO)&255
    1410/     73E : AF                             PLO     X
    1411/     73F : F1                             OR                ;IF THERE IS ONE
    1412/     740 : 32 4E                          BZ      INSX      ;NO, EXIT
    1413/     742 : 8F                             GLO     X         ;ELSE INSERT LINE NUMBER
    1414/     743 : 5A                             STR     AC
    1415/     744 : 1A                             INC     AC
    1416/     745 : 4D                             LDA     PZ
    1417/     746 : 5A                             STR     AC
    1418/     747 : 1A                             INC     AC
    1419/     748 : 4B                             LDA     BP        ;NOW REST OF LINE
    1420/     749 : 5A                             STR     AC
    1421/     74A : FB 0D                          XRI     00Dh      ;TO <CR>
    1422/     74C : 3A 47                          BNZ     $-5
    1423/     74E : C0 03 B5            INSX       LBR     EXIT
    1424/     751 : 73                  IO         STXD              ;PUSH OUT BYTE
    1425/     752 : 52                             STR     R2
    1426/     753 : (MACRO)                        LDI0              ;CLEAR AC
    1426/     753 : 9D                          GHI RD 
    1427/     754 : BA                             PHI     AC
    1428/     755 : 2D                             DEC     PZ
    1429/     756 : 43                             LDA     R3        ;STORE RETURN IN RAM
    1430/     757 : D5                             SEP     R5        ;(THIS IS NOT EXECUTED)
    1431/     758 : 5D                             STR     PZ
    1432/     759 : 2D                             DEC     PZ
    1433/     75A : 88                             GLO     XX        ;MAKE IO INSTRUCTION
    1434/     75B : FA 0F                          ANI     00Fh
    1435/     75D : F9 60                          ORI     060h
    1436/     75F : 5D                             STR     PZ
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 30 - 09/30/24 17:27:32


    1437/     760 : FA 08                          ANI     8
    1438/     762 : CE                             LSZ
    1439/     763 : C4                             NOP               ;INPUT, SO
    1440/     764 : 12                             INC     R2        ;DO INCREMENT NOW
    1441/     765 : DD                             SEP     PZ        ;GO EXECUTE, RESULT IN D
    1442/     766 :                     
    1443/     766 : 24 3A 91            STRT    DB 024h, 03Ah, 091h ;    PC      ':Q^'  Start Of IL Program
    1444/     769 : 27                          DB 027h ;                GL
    1445/     76A : 10                          DB 010h ;                SB
    1446/     76B : E1                          DB 0E1h ;                BE      :LO
    1447/     76C : 59                          DB 059h ;                BR      :STRT
    1448/     76D : C5                  LO      DB 0C5h ;                BN      :STMT
    1449/     76E : 2A                          DB 02Ah ;                IL
    1450/     76F : 56                          DB 056h ;                BR      :STRT
    1451/     770 : 10                  XEC     DB 010h ;                SB
    1452/     771 : 11                          DB 011h ;                RB
    1453/     772 : 2C                          DB 02Ch ;                XQ
    1454/     773 : 8B 4C 45            STMT    DB 08Bh, 04Ch, 045h ;            BC      :GOTO     'LET'
    1455/     776 : D4                          DB 0D4h;
    1456/     777 :                     ; !18 In Following Is Not Required It Was Generated By My
    1457/     777 :                     ; Dissassembler And Indicates The Error Code Produced
    1458/     777 :                     ; At This Point, The Assembler Assumes This Is A Remark
    1459/     777 : A0                          DB 0A0h ;                BV      * !18
    1460/     778 : 80 BD                       DB 080h, 0BDh ;              BC      * !20     '='
    1461/     77A : 31 8F               LET     DB 031h, 08Fh ;       JS      :EXPR
    1462/     77C : E0                          DB 0E0h ;                BE      * !23
    1463/     77D : 13                          DB 013h ;                SV
    1464/     77E : 1D                          DB 01Dh ;                NX
    1465/     77F : 94 47 CF            GOTO    DB 094h, 047h, 0CFh ;      BC      :PRNT     'GO'
    1466/     782 : 88 54 CF                    DB 088h, 054h, 0CFh ;            BC      :GOSB     'TO'
    1467/     785 : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1468/     787 : E0                          DB 0E0h ;                BE      * !34
    1469/     788 : 10                          DB 010h ;                SB
    1470/     789 : 11                          DB 011h ;                RB
    1471/     78A : 16                          DB 016h ;                GO
    1472/     78B : 80 53 55            GOSB    DB 080h, 053h, 055h ;      BC      * !39     'SUB'
    1473/     78E : C2                          DB 0C2h;                --
    1474/     78F : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1475/     791 : E0                          DB 0E0h ;                BE      * !44
    1476/     792 : 14                          DB 014h ;                GS
    1477/     793 : 16                          DB 016h ;                GO
    1478/     794 : 90 50 D2            PRNT    DB 090h, 050h, 0D2h ;      BC      :SKIP     'PR'
    1479/     797 : 83 49 4E                    DB 083h, 049h, 04Eh ;            BC      :P0       'INT'
    1480/     79A : D4                          DB 0D4h;                --
    1481/     79B : E5                  P0      DB 0E5h ;        BE      :P3
    1482/     79C : 71                          DB 071h ;                BR      Z233
    1483/     79D : 88 BB               P1      DB 088h, 0BBh ;        BC      Z234      ';'
    1484/     79F : E1                  P2      DB 0E1h ;        BE      :P3
    1485/     7A0 : 1D                          DB 01Dh ;                NX
    1486/     7A1 : 8F A2               P3      DB 08Fh, 0A2h ;        BC      Z235      '"'
    1487/     7A3 : 21                          DB 021h ;                PQ
    1488/     7A4 : 58                          DB 058h ;                BR      :P1
    1489/     7A5 : 6F                  SKIP_   DB 06Fh ;      BR      :IF
    1490/     7A6 : 83 AC                       DB 083h, 0ACh ;   Z234       BC      Z236      ','
    1491/     7A8 : 22                          DB 022h ;                PT
    1492/     7A9 : 55                          DB 055h ;                BR      :P2
    1493/     7AA : 83 BA                       DB 083h, 0BAh ;   Z236       BC      Z233      ':'
    1494/     7AC : 24 93                       DB 024h, 093h ;              PC                'S^'
    1495/     7AE : E0                          DB 0E0h ;     Z233       BE      * !73
    1496/     7AF : 23                          DB 023h ;                NL
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 31 - 09/30/24 17:27:32


    1497/     7B0 : 1D                          DB 01Dh ;                NX
    1498/     7B1 : 31 8F                       DB 031h, 08Fh ;   Z235       JS      :EXPR
    1499/     7B3 : 20                          DB 020h ;                PN
    1500/     7B4 : 48                          DB 048h ;                BR      :P1
    1501/     7B5 : 91 49 C6            IF_     DB 091h, 049h, 0C6h ;        BC      :INPT     'IF'
    1502/     7B8 : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1503/     7BA : 32 37                       DB 032h, 037h ;              JS      Z237
    1504/     7BC : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1505/     7BE : 84 54 48                    DB 084h, 054h, 048h ;            BC      :I1       'THEN'
    1506/     7C1 : 45 CE                       DB 045h, 0CEh ;              --
    1507/     7C3 : 1C                  I1      DB 01Ch ;        CP
    1508/     7C4 : 1D                          DB 01Dh ;                NX
    1509/     7C5 : 38 0D                       DB 038h, 00Dh ;              J       :STMT
    1510/     7C7 : 9A 49 4E            INPT    DB 09Ah, 049h, 04Eh ;      BC      :RETN     'INPUT'
    1511/     7CA : 50 55 D4                    DB 050h, 055h, 0D4h ;            --
    1512/     7CD : A0                          DB 0A0h ;     Z242       BV      * !104
    1513/     7CE : 10                          DB 010h ;                SB
    1514/     7CF : E7                          DB 0E7h ;                BE      Z238
    1515/     7D0 : 24 3F 20                    DB 024h, 03Fh, 020h ; Z239       PC                '? Q^'
    1516/     7D3 : 91                          DB 091h;                --
    1517/     7D4 : 27                          DB 027h ;                GL
    1518/     7D5 : E1                          DB 0E1h ;                BE      Z238
    1519/     7D6 : 59                          DB 059h ;                BR      Z239
    1520/     7D7 : 81 AC                       DB 081h, 0ACh ;   Z238       BC      Z240      ','
    1521/     7D9 : 31 8F                       DB 031h, 08Fh ;   Z240       JS      :EXPR
    1522/     7DB : 13                          DB 013h ;                SV
    1523/     7DC : 11                          DB 011h ;                RB
    1524/     7DD : 82 AC                       DB 082h, 0ACh ;              BC      Z241      ','
    1525/     7DF : 4D                          DB 04Dh ;                BR      Z242
    1526/     7E0 : E0                          DB 0E0h ;     Z241       BE      * !123
    1527/     7E1 : 1D                          DB 01Dh ;                NX
    1528/     7E2 : 89 52 45            RETN_   DB 089h, 052h, 045h ;      BC      :END      'RETURN'
    1529/     7E5 : 54 55 52                    DB 054h, 055h, 052h ;            --
    1530/     7E8 : CE                          DB 0CEh;                --
    1531/     7E9 : E0                          DB 0E0h ;                BE      * !132
    1532/     7EA : 15                          DB 015h ;                RS
    1533/     7EB : 1D                          DB 01Dh ;                NX
    1534/     7EC : 85 45 4E            END     DB 085h, 045h, 04Eh ;       BC      :LIST     'END'
    1535/     7EF : C4                          DB 0C4h;                --
    1536/     7F0 : E0                          DB 0E0h ;                BE      * !139
    1537/     7F1 : 2D                          DB 02Dh ;                WS
    1538/     7F2 : 9A 4C 49            LIST_   DB 09Ah, 04Ch, 049h ;      BC      :RUN      'LIST'
    1539/     7F5 : 53 D4                       DB 053h, 0D4h ;              --
    1540/     7F7 : E7                          DB 0E7h ;                BE      Z243
    1541/     7F8 : 0A 00 01                    DB 00Ah, 000h, 001h ;            LN      #0001
    1542/     7FB : 0A 7F FF                    DB 00Ah, 07Fh, 0FFh ;            LN      #7FFF
    1543/     7FE : 65                          DB 065h ;                BR      Z244
    1544/     7FF : 31 8F                       DB 031h, 08Fh ;   Z243       JS      :EXPR
    1545/     801 : 32 31                       DB 032h, 031h ;              JS      Z245
    1546/     803 : E0                          DB 0E0h ;                BE      * !158
    1547/     804 : 24 00 00                    DB 024h, 000h, 000h ; Z244       PC                '@^@^@^@^J^@^'
    1548/     807 : 00 00 0A                    DB 000h, 000h, 00Ah ;            --
    1549/     80A : 80                          DB 080h;                --
    1550/     80B : 1F                          DB 01Fh ;                LS
    1551/     80C : 1D                          DB 01Dh ;                NX
    1552/     80D : 85 52 55            RUN_    DB 085h, 052h, 055h ;       BC      :CLER     'RUN'
    1553/     810 : CE                          DB 0CEh;                --
    1554/     811 : 38 0A                       DB 038h, 00Ah ;              J       :XEC
    1555/     813 : 86 43 4C            CLER    DB 086h, 043h, 04Ch ;      BC      :PLOT     'CLEAR'
    1556/     816 : 45 41 D2                    DB 045h, 041h, 0D2h ;            --
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 32 - 09/30/24 17:27:32


    1557/     819 : 2B                          DB 02Bh ;                MT
    1558/     81A : 9A 50 4C            PLOT    DB 09Ah, 050h, 04Ch ;      BC      Z246      'PLOT'
    1559/     81D : 4F D4                       DB 04Fh, 0D4h ;              --
    1560/     81F : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1561/     821 : 95 AC                       DB 095h, 0ACh ;              BC      Z247      ','
    1562/     823 : 0B                          DB 00Bh ;                DS
    1563/     824 : 0B                          DB 00Bh ;                DS
    1564/     825 : 0A 00 2A                    DB 00Ah, 000h, 02Ah ;            LN      42
    1565/     828 : 32 62                       DB 032h, 062h ;              JS      Z248      COMPARE >0 AND <42
    1566/     82A : 0A 00 40                    DB 00Ah, 000h, 040h ;            LN      64        MULTIPLY BY 64
    1567/     82D : 1A                          DB 01Ah ;                MP
    1568/     82E : 0A 00 40                    DB 00Ah, 000h, 040h ;            LN      64
    1569/     831 : 32 5A                       DB 032h, 05Ah ;              JS      Z249      GET NEXT EXPR AND COMP >0 AND <64
    1570/     833 : 18                          DB 018h ;                AD                ADD TOGETHER (X*64+Y)
    1571/     834 : 64                          DB 064h ;                BR      Z250      SKIP JUMPS
    1572/     835 : 39 02                       DB 039h, 002h ;   Z246       J       :POKE
    1573/     837 : 38 F4                       DB 038h, 0F4h ;   Z247       J       Z251
    1574/     839 : 0A 6D 80                    DB 00Ah, 06Dh, 080h ; Z250       LN      BUFF<<3         BUFF*8
    1575/     83C : 18                          DB 018h ;                AD                ADD (BUFF*8)+(X*64+Y)
    1576/     83D : 0B                          DB 00Bh ;                DS
    1577/     83E : 0A 00 08                    DB 00Ah, 000h, 008h ;            LN      8
    1578/     841 : 1B                          DB 01Bh ;                DV                ((BUFF*8)+(X*64+Y))/8
    1579/     842 : 0B                          DB 00Bh ;                DS
    1580/     843 : 04                          DB 004h ;                SX 4
    1581/     844 : 02                          DB 002h ;                SX 2
    1582/     845 : 05                          DB 005h ;                SX 5
    1583/     846 : 03                          DB 003h ;                SX 3
    1584/     847 : 05                          DB 005h ;                SX 5
    1585/     848 : 0A 00 08                    DB 00Ah, 000h, 008h ;            LN      8
    1586/     84B : 1A                          DB 01Ah ;                MP                 MULTIPLY BY 8
    1587/     84C : 19                          DB 019h ;                SU                 GET REMANDER
    1588/     84D : 09 0A                       DB 009h, 00Ah ;              LB      TVXY+2
    1589/     84F : 02                          DB 002h ;                SX 2
    1590/     850 : 13                          DB 013h ;                SV                 STORE NEW BIT POINTER
    1591/     851 : 09 08                       DB 009h, 008h ;              LB      TVXY
    1592/     853 : 02                          DB 002h ;                SX 2
    1593/     854 : 01                          DB 001h ;                SX 1
    1594/     855 : 13                          DB 013h ;                SV                 STORE NEW CURSOR
    1595/     856 : 8F AC                       DB 08Fh, 0ACh ;              BC      Z252      ','
    1596/     858 : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1597/     85A : E0                          DB 0E0h ;     Z251       BE      * !245
    1598/     85B : 0A 01 09                    DB 00Ah, 001h, 009h ;            LN      TYPEV
    1599/     85E : 02                          DB 002h ;                SX 2
    1600/     85F : 01                          DB 001h ;                SX 1
    1601/     860 : 03                          DB 003h ;                SX 3
    1602/     861 : 01                          DB 001h ;                SX 1
    1603/     862 : 0B                          DB 00Bh ;                DS
    1604/     863 : 2E                          DB 02Eh ;                US                CALL TYPEV AND OUTPUT BYTE
    1605/     864 : 0C                          DB 00Ch ;                SP                POP RETURNED VALUE
    1606/     865 : 1D                          DB 01Dh ;                NX                NEXT STATEMENT
    1607/     866 : E0                          DB 0E0h ;     Z252       BE      * !257
    1608/     867 : 1D                          DB 01Dh ;                NX
    1609/     868 : 8A 50 4F            POKE    DB 08Ah, 050h, 04Fh ;      BC      :OUT      'POKE'
    1610/     86B : 4B C5                       DB 04Bh, 0C5h ;              --
    1611/     86D : 0A 01 18                    DB 00Ah, 001h, 018h ;            LN      ILPOKE
    1612/     870 : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1613/     872 : 6C                          DB 06Ch ;                BR      Z253
    1614/     873 : 91 4F 55            OUT_    DB 091h, 04Fh, 055h ;       BC      :SAVE     'OUT'
    1615/     876 : D4                          DB 0D4h;                --
    1616/     877 : 0A 01 26                    DB 00Ah, 001h, 026h ;            LN      ILINPOUT
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 33 - 09/30/24 17:27:32


    1617/     87A : 0A 00 08                    DB 00Ah, 000h, 008h ;            LN      8
    1618/     87D : 32 5A                       DB 032h, 05Ah ;              JS      Z249      GET EXPR AND COMP >0 AND <8
    1619/     87F : 32 31                       DB 032h, 031h ;   Z253       JS      Z245      CHECK FOR ,AND GET EXPR
    1620/     881 : E0                          DB 0E0h ;                BE      * !284
    1621/     882 : 2E                          DB 02Eh ;                US                CALL ILINPOUT OR ILPOKE
    1622/     883 : 0C                          DB 00Ch ;                SP                POP RETURNED VALUE
    1623/     884 : 1D                          DB 01Dh ;                NX                NEXT STATEMENT
    1624/     885 : 9E 53 41            SAVE    DB 09Eh, 053h, 041h ;      BC      Z254      'SAVE'
    1625/     888 : 56 C5                       DB 056h, 0C5h;               --
    1626/     88A : E0                          DB 0E0h ;                BE      * !293
    1627/     88B : 24 54 55                    DB 024h, 054h, 055h ;            PC                'TURN ON RECORD'
    1628/     88E : 52 4E 20                    DB 052h, 04Eh, 020h ;            --
    1629/     891 : 4F 4E 20                    DB 04Fh, 04Eh, 020h ;            --
    1630/     894 : 52 45 43                    DB 052h, 045h, 043h ;            --
    1631/     897 : 4F 52 C4                    DB 04Fh, 052h, 0C4h ;            --
    1632/     89A : 23                          DB 023h ;                NL
    1633/     89B : 24 48 49                    DB 024h, 048h, 049h ;            PC                'HIT KEY'
    1634/     89E : 54 20 4B                    DB 054h, 020h, 04Bh ;            --
    1635/     8A1 : 45 D9                       DB 045h, 0D9h;               --
    1636/     8A3 : 62                          DB 062h ;                BR      Z255
    1637/     8A4 : 39 5C                       DB 039h, 05Ch ;   Z254       J       :LOAD
    1638/     8A6 : 0A 01 06                    DB 00Ah, 001h, 006h ; Z255       LN      KEYV
    1639/     8A9 : 0B                          DB 00Bh ;                DS
    1640/     8AA : 0B                          DB 00Bh ;                DS
    1641/     8AB : 2E                          DB 02Eh ;                US                CALL KEY INPUT
    1642/     8AC : 0C                          DB 00Ch ;                SP                POP RETURNED VALUE
    1643/     8AD : 23                          DB 023h ;                NL                NEW LINE
    1644/     8AE : 0A 09 FD                    DB 00Ah, 009h, 0FDh ;            LN      ILSAVE
    1645/     8B1 : 09 24                       DB 009h, 024h ;              LB      MEND
    1646/     8B3 : 12                          DB 012h ;                FV
    1647/     8B4 : 09 20                       DB 009h, 020h ;              LB      BASIC
    1648/     8B6 : 12                          DB 012h ;                FV
    1649/     8B7 : 19                          DB 019h ;                SU                END PROGRAM-BEGIN PROGRAM
    1650/     8B8 : 0A 01 00                    DB 00Ah, 001h, 000h ;            LN      256
    1651/     8BB : 18                          DB 018h ;                AD                ADD 256 ????
    1652/     8BC : 09 20                       DB 009h, 020h ;              LB      BASIC
    1653/     8BE : 12                          DB 012h ;                FV
    1654/     8BF : 2E                          DB 02Eh ;                US                CALL ILSAVE
    1655/     8C0 : 0C                          DB 00Ch ;                SP                POP RETURNED VALUE
    1656/     8C1 : 1D                          DB 01Dh ;                NX                NEXT STATEMENT
    1657/     8C2 : 86 4C 4F            LOAD    DB 086h, 04Ch, 04Fh ;            BC      Z256      'LOAD'
    1658/     8C5 : 41 C4                       DB 041h, 0C4h ;              --
    1659/     8C7 : E0                          DB 0E0h ;                BE      * !354
    1660/     8C8 : 62                          DB 062h ;                BR      Z257
    1661/     8C9 : 39 85                       DB 039h, 085h ;   Z256       J       Z258
    1662/     8CB : 09 24                       DB 009h, 024h ;   Z257       LB      MEND
    1663/     8CD : 0A 09 FA                    DB 00Ah, 009h, 0FAh ;            LN      ILLOAD
    1664/     8D0 : 0A 00 01                    DB 00Ah, 000h, 001h ;            LN      1
    1665/     8D3 : 09 20                       DB 009h, 020h ;              LB      BASIC
    1666/     8D5 : 12                          DB 012h ;                FV
    1667/     8D6 : 2E                          DB 02Eh ;                US                CALL ILLOAD
    1668/     8D7 : 66                          DB 066h ;                BR      Z259      ILLOAD SKIPS THIS IF NO ERROR
    1669/     8D8 : 0A 00 18                    DB 00Ah, 000h, 018h ;            LN      0x18      SPARE STACK SIZE-1,DOES NOT GET IT?
    1670/     8DB : 18                          DB 018h ;                AD                ADD TO RETURN VALUE
    1671/     8DC : 13                          DB 013h ;                SV                SAVE MEM END
    1672/     8DD : 2D                          DB 02Dh ;                WS                WARM START
    1673/     8DE : 23                          DB 023h ;     Z259       NL
    1674/     8DF : 24 54 41                    DB 024h, 054h, 041h ;            PC                'TAPE ERROR'
    1675/     8E2 : 50 45 20                    DB 050h, 045h, 020h ;            --
    1676/     8E5 : 45 52 52                    DB 045h, 052h, 052h ;            --
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 34 - 09/30/24 17:27:32


    1677/     8E8 : 4F D2                       DB 04Fh, 0D2h ;              --
    1678/     8EA : 2B                          DB 02Bh ;                MT
    1679/     8EB : 84 52 45                    DB 084h, 052h, 045h ; Z258       BC      :DFLT     'REM'
    1680/     8EE : CD                          DB 0CDh;                --
    1681/     8EF : 1D                          DB 01Dh ;                NX
    1682/     8F0 : A0                  DFLT    DB 0A0h ;                BV      * !395
    1683/     8F1 : 80 BD                       DB 080h, 0BDh ;              BC      * !397    '='
    1684/     8F3 : 38 14                       DB 038h, 014h ;              J       :LET
    1685/     8F5 : 85 AD               EXPR    DB 085h, 0ADh ;      BC      Z260      '-'
    1686/     8F7 : 31 A6                       DB 031h, 0A6h ;              JS      :TERM
    1687/     8F9 : 17                          DB 017h ;                NE
    1688/     8FA : 64                          DB 064h ;                BR      Z261
    1689/     8FB : 81 AB                       DB 081h, 0ABh ;   Z260       BC      Z262      '+'
    1690/     8FD : 31 A6                       DB 031h, 0A6h ;   Z262       JS      :TERM
    1691/     8FF : 85 AB                       DB 085h, 0ABh ;   Z261       BC      Z263      '+'
    1692/     901 : 31 A6                       DB 031h, 0A6h ;              JS      :TERM
    1693/     903 : 18                          DB 018h ;                AD
    1694/     904 : 5A                          DB 05Ah ;                BR      Z261
    1695/     905 : 85 AD                       DB 085h, 0ADh ;   Z263       BC      Z264      '-'
    1696/     907 : 31 A6                       DB 031h, 0A6h ;              JS      :TERM
    1697/     909 : 19                          DB 019h ;                SU
    1698/     90A : 54                          DB 054h ;                BR      Z261
    1699/     90B : 2F                          DB 02Fh ;     Z264       RT
    1700/     90C : 31 B5               TERM    DB 031h, 0B5h ;      JS      :RND
    1701/     90E : 85 AA                       DB 085h, 0AAh ;   Z266       BC      Z265      '*'
    1702/     910 : 31 B5                       DB 031h, 0B5h ;              JS      :RND
    1703/     912 : 1A                          DB 01Ah ;                MP
    1704/     913 : 5A                          DB 05Ah ;                BR      Z266
    1705/     914 : 85 AF                       DB 085h, 0AFh ;   Z265       BC      Z267      '/'
    1706/     916 : 31 B5                       DB 031h, 0B5h ;              JS      :RND
    1707/     918 : 1B                          DB 01Bh ;                DV
    1708/     919 : 54                          DB 054h ;                BR      Z266
    1709/     91A : 2F                          DB 02Fh ;     Z267       RT
    1710/     91B : 99 52 4E            RND     DB 099h, 052h, 04Eh ;       BC      Z268      'RND('
    1711/     91E : 44 A8                       DB 044h, 0A8h ;              --
    1712/     920 : 0A 80 80                    DB 00Ah, 080h, 080h ;            LN      0x8080
    1713/     923 : 12                          DB 012h ;                FV
    1714/     924 : 0A 09 29                    DB 00Ah, 009h, 029h ;            LN      0x0929
    1715/     927 : 1A                          DB 01Ah ;                MP
    1716/     928 : 0A 1A 85                    DB 00Ah, 01Ah, 085h ;            LN      0x1A85
    1717/     92B : 18                          DB 018h ;                AD
    1718/     92C : 13                          DB 013h ;                SV
    1719/     92D : 09 80                       DB 009h, 080h ;              LB      0x80
    1720/     92F : 12                          DB 012h ;                FV
    1721/     930 : 01                          DB 001h ;                SX 1
    1722/     931 : 0B                          DB 00Bh ;                DS
    1723/     932 : 32 2C                       DB 032h, 02Ch ;              JS      Z269
    1724/     934 : 61                          DB 061h ;                BR      Z270
    1725/     935 : 72                          DB 072h ;     Z268       BR      :USR
    1726/     936 : 0B                          DB 00Bh ;     Z270       DS
    1727/     937 : 04                          DB 004h ;                SX 4
    1728/     938 : 02                          DB 002h ;                SX 2
    1729/     939 : 03                          DB 003h ;                SX 3
    1730/     93A : 05                          DB 005h ;                SX 5
    1731/     93B : 03                          DB 003h ;                SX 3
    1732/     93C : 1B                          DB 01Bh ;                DV
    1733/     93D : 1A                          DB 01Ah ;                MP
    1734/     93E : 19                          DB 019h ;                SU
    1735/     93F : 0B                          DB 00Bh ;                DS
    1736/     940 : 09 06                       DB 009h, 006h ;              LB      6
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 35 - 09/30/24 17:27:32


    1737/     942 : 0A 00 00                    DB 00Ah, 000h, 000h ;            LN      0
    1738/     945 : 1C                          DB 01Ch ;                CP
    1739/     946 : 17                          DB 017h ;                NE
    1740/     947 : 2F                          DB 02Fh ;                RT
    1741/     948 : 8E 55 53            USR     DB 08Eh, 055h, 053h ;       BC      :INP      'USR('
    1742/     94B : 52 A8                       DB 052h, 0A8h ;              --
    1743/     94D : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1744/     94F : 32 31                       DB 032h, 031h ;              JS      Z245
    1745/     951 : 32 31                       DB 032h, 031h ;              JS      Z245
    1746/     953 : 80 A9                       DB 080h, 0A9h ;              BC      * !495    ')'
    1747/     955 : 2E                          DB 02Eh ;                US
    1748/     956 : 2F                          DB 02Fh ;                RT
    1749/     957 : 91 49 4E            INP     DB 091h, 049h, 04Eh ;       BC      :FLG      'INP('
    1750/     95A : 50 A8                       DB 050h, 0A8h ;              --
    1751/     95C : 0A 01 26                    DB 00Ah, 001h, 026h ;            LN      ILINPOUT
    1752/     95F : 0A 00 08                    DB 00Ah, 000h, 008h ;            LN      8
    1753/     962 : 32 5A                       DB 032h, 05Ah ;              JS      Z249      GET EXPR AND COMP >0 AND <8
    1754/     964 : 0A 00 08                    DB 00Ah, 000h, 008h ;            LN      8         ADD 8 TO OP FOR INPUT
    1755/     967 : 18                          DB 018h ;                AD
    1756/     968 : 7D                          DB 07Dh ;                BR      Z271
    1757/     969 : 91 46 4C            FLG     DB 091h, 046h, 04Ch ;       BC      :PEEK     'FLG('
    1758/     96C : 47 A8                       DB 047h, 0A8h ;              --
    1759/     96E : 0A 09 F8                    DB 00Ah, 009h, 0F8h ;            LN      ILFLG     FLG WAS NEVER DOCUMENTED
    1760/     971 : 0A 00 05                    DB 00Ah, 000h, 005h ;            LN      5
    1761/     974 : 32 5A                       DB 032h, 05Ah ;              JS      Z249      GET EXPR AND COMP >0 AND <5
    1762/     976 : 0A 00 01                    DB 00Ah, 000h, 001h ;            LN      1
    1763/     979 : 19                          DB 019h ;                SU                SUB 1
    1764/     97A : 6B                          DB 06Bh ;                BR      Z271
    1765/     97B : 8F 50 45            PEEK_   DB 08Fh, 050h, 045h ;      BC      Z272      'PEEK('
    1766/     97E : 45 4B A8                    DB 045h, 04Bh, 0A8h ;            --
    1767/     981 : 0A 01 14                    DB 00Ah, 001h, 014h ;            LN      ILPEEK
    1768/     984 : 31 8F                       DB 031h, 08Fh ;              JS      :EXPR
    1769/     986 : 80 A9                       DB 080h, 0A9h ;   Z271       BC      * !546    ')'
    1770/     988 : 0B                          DB 00Bh ;                DS
    1771/     989 : 2E                          DB 02Eh ;                US
    1772/     98A : 2F                          DB 02Fh ;                RT
    1773/     98B : A2                          DB 0A2h ;     Z272       BV      Z273
    1774/     98C : 12                          DB 012h ;                FV
    1775/     98D : 2F                          DB 02Fh ;                RT
    1776/     98E : C1                          DB 0C1h ;     Z273       BN      Z274
    1777/     98F : 2F                          DB 02Fh ;                RT
    1778/     990 : 80 A8                       DB 080h, 0A8h ;   Z274       BC      * !556    '('
    1779/     992 : 31 8F                       DB 031h, 08Fh ;   Z269       JS      :EXPR
    1780/     994 : 80 A9                       DB 080h, 0A9h ;              BC      * !560    ')'
    1781/     996 : 2F                          DB 02Fh ;                RT
    1782/     997 : 83 AC                       DB 083h, 0ACh ;   Z245       BC      Z275      ','
    1783/     999 : 39 8F                       DB 039h, 08Fh ;              J       :EXPR
    1784/     99B : 0B                          DB 00Bh ;     Z275       DS
    1785/     99C : 2F                          DB 02Fh ;                RT
    1786/     99D : 84 BD                       DB 084h, 0BDh ;   Z237       BC      Z276      '='
    1787/     99F : 09 02                       DB 009h, 002h ;              LB      2
    1788/     9A1 : 2F                          DB 02Fh ;                RT
    1789/     9A2 : 8E BC                       DB 08Eh, 0BCh ;   Z276       BC      Z277      '<'
    1790/     9A4 : 84 BD                       DB 084h, 0BDh ;              BC      Z278      '='
    1791/     9A6 : 09 03                       DB 009h, 003h ;              LB      3
    1792/     9A8 : 2F                          DB 02Fh ;                RT
    1793/     9A9 : 84 BE                       DB 084h, 0BEh ;   Z278       BC      Z279      '>'
    1794/     9AB : 09 05                       DB 009h, 005h ;              LB      5
    1795/     9AD : 2F                          DB 02Fh ;                RT
    1796/     9AE : 09 01                       DB 009h, 001h ;   Z279       LB      1
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 36 - 09/30/24 17:27:32


    1797/     9B0 : 2F                          DB 02Fh ;                RT
    1798/     9B1 : 80 BE                       DB 080h, 0BEh ;   Z277       BC      * !589    '>'
    1799/     9B3 : 84 BD                       DB 084h, 0BDh ;              BC      Z280      '='
    1800/     9B5 : 09 06                       DB 009h, 006h ;              LB      6
    1801/     9B7 : 2F                          DB 02Fh ;                RT
    1802/     9B8 : 84 BC                       DB 084h, 0BCh ;   Z280       BC      Z281      '<'
    1803/     9BA : 09 05                       DB 009h, 005h ;              LB      5
    1804/     9BC : 2F                          DB 02Fh ;                RT
    1805/     9BD : 09 04                       DB 009h, 004h ;   Z281       LB      4
    1806/     9BF : 2F                          DB 02Fh ;                RT
    1807/     9C0 : 31 8F                       DB 031h, 08Fh ;   Z249       JS      :EXPR
    1808/     9C2 : 0B                          DB 00Bh ;                DS
    1809/     9C3 : 0B                          DB 00Bh ;                DS
    1810/     9C4 : 06                          DB 006h ;                SX 6
    1811/     9C5 : 01                          DB 001h ;                SX 1
    1812/     9C6 : 07                          DB 007h ;                SX 7
    1813/     9C7 : 01                          DB 001h ;                SX 1
    1814/     9C8 : 09 01                       DB 009h, 001h ;   Z248       LB      1
    1815/     9CA : 02                          DB 002h ;                SX 2
    1816/     9CB : 01                          DB 001h ;                SX 1
    1817/     9CC : 1C                          DB 01Ch ;                CP
    1818/     9CD : 60                          DB 060h ;                BR      * !616
    1819/     9CE : 09 06                       DB 009h, 006h ;              LB      6
    1820/     9D0 : 0A 00 00                    DB 00Ah, 000h, 000h ;            LN      0
    1821/     9D3 : 1C                          DB 01Ch ;                CP
    1822/     9D4 : 60                          DB 060h;                BR      * !623
    1823/     9D5 : 2F                  ENDIL   DB 02Fh;                RT                 End Of IL Program
    1824/     9D6 : 00 00                       DB 0, 0
    1825/     9D8 : F8 82               TVON       LDI     (INTERUPT)&255  ;SETUP INTERRUPT ROUTINE
    1826/     9DA : A1                             PLO     R1
    1827/     9DB : F8 0C                          LDI     (INTERUPT)>>8
    1828/     9DD : B1                             PHI     R1
    1829/     9DE : 34 DE               -          B1      -         ;LOOP UNTIL EF1 GOES FALSE
    1830/     9E0 :                     ;                  (EF1 brackets the 1861 interrupt request)
    1831/     9E0 : 69                             INP     1         ;TURN ON 1861
    1832/     9E1 : E3                             SEX     R3
    1833/     9E2 : 70                             RET               ;ENABLE INTERRUPTS
    1834/     9E3 : (MACRO)                        RETURN
    1834/     9E3 : D5                          SEP R5
    1835/     9E4 : F9 34               Z283       ORI     034h      ;MAKE FLG BRANCH
    1836/     9E6 : BF                             PHI     RF        ;SAVE HIGH F
    1837/     9E7 : 2D                             DEC     RD
    1838/     9E8 : ED                             SEX     RD        ;X=D
    1839/     9E9 : 8D                             GLO     RD        ;GLO D TO BRANCH TOO
    1840/     9EA : AF                             PLO     RF        ;SAVE IN LOW F
    1841/     9EB : F8 D5                          LDI     0D5h       ;STORE RETURN
    1842/     9ED : 73                             STXD
    1843/     9EE : F8 9D                          LDI     09Dh       ;LDI0      STORE CLEAR
    1844/     9F0 : 73                             STXD
    1845/     9F1 : 8F                             GLO     RF        ;STORE BRANCH TOO ADDRESS
    1846/     9F2 : 73                             STXD
    1847/     9F3 : 9F                             GHI     RF        ;STORE BRANCH INSTUCTION
    1848/     9F4 : 5D                             STR     RD
    1849/     9F5 : F8 01                          LDI     1         ;LOAD 1
    1850/     9F7 : DD                             SEP     RD        ;EXAMPLE  34XX  9D D5 BRANCH SKIPS C
    1851/     9F8 : 30 E4               ILFLG      BR      Z283
    1852/     9FA : C0 0A 29            ILLOAD     LBR     Z284
    1853/     9FD : F8 F0               ILSAVE     LDI     0F0h        ;SAVE TO TAPE
    1854/     9FF : BC                             PHI     RC
    1855/     A00 : F8 65                          LDI     065h
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 37 - 09/30/24 17:27:32


    1856/     A02 : AC                             PLO     RC
    1857/     A03 : F8 80                          LDI     080h
    1858/     A05 : BD                             PHI     RD
    1859/     A06 : FF 00               Z285       SMI     0
    1860/     A08 : DC                             SEP     RC         ;GOSUB #F065 ROM CALLS
    1861/     A09 : 9D                             GHI     RD
    1862/     A0A : 3A 06                          BNZ     Z285
    1863/     A0C : 7B                  Z287       SEQ
    1864/     A0D : 4A                             LDA     RA
    1865/     A0E : BF                             PHI     RF
    1866/     A0F : F8 09                          LDI     9
    1867/     A11 : AF                             PLO     RF
    1868/     A12 : AD                             PLO     RD
    1869/     A13 : FE                             SHL
    1870/     A14 : DC                  Z286       SEP     RC
    1871/     A15 : 2F                             DEC     RF
    1872/     A16 : 9F                             GHI     RF
    1873/     A17 : FE                             SHL
    1874/     A18 : BF                             PHI     RF
    1875/     A19 : 8F                             GLO     RF
    1876/     A1A : 3A 14                          BNZ     Z286
    1877/     A1C : 8D                             GLO     RD
    1878/     A1D : F6                             SHR
    1879/     A1E : DC                             SEP     RC
    1880/     A1F : 28                             DEC     R8
    1881/     A20 : 98                             GHI     R8
    1882/     A21 : 3A 0C                          BNZ     Z287
    1883/     A23 : DC                             SEP     RC
    1884/     A24 : DC                             SEP     RC
    1885/     A25 : DC                             SEP     RC
    1886/     A26 : DC                             SEP     RC
    1887/     A27 : 7A                             REQ
    1888/     A28 : (MACRO)                        RETURN
    1888/     A28 : D5                          SEP R5
    1889/     A29 : F8 F0               Z284       LDI     0F0h        ;LOAD FROM TAPE
    1890/     A2B : BC                             PHI     RC
    1891/     A2C : F8 BA                          LDI     0BAh
    1892/     A2E : AC                             PLO     RC
    1893/     A2F : F8 F9               Z288       LDI     0F9h
    1894/     A31 : BD                             PHI     RD
    1895/     A32 : DC                  Z289       SEP     RC         ;GOSUB #F0BA ROM CALLS
    1896/     A33 : 3B 2F                          BNF     Z288
    1897/     A35 : 9D                             GHI     RD
    1898/     A36 : 3A 32                          BNZ     Z289
    1899/     A38 : DC                  Z290       SEP     RC
    1900/     A39 : 33 38                          BDF     Z290
    1901/     A3B : F8 01                          LDI     1
    1902/     A3D : BD                             PHI     RD
    1903/     A3E : AD                             PLO     RD
    1904/     A3F : DC                  Z291       SEP     RC
    1905/     A40 : 9D                             GHI     RD
    1906/     A41 : 7E                             SHLC
    1907/     A42 : BD                             PHI     RD
    1908/     A43 : 3B 3F                          BNF     Z291
    1909/     A45 : DC                             SEP     RC
    1910/     A46 : 8D                             GLO     RD
    1911/     A47 : F6                             SHR
    1912/     A48 : 33 59                          BDF     Z292
    1913/     A4A : 9D                             GHI     RD
    1914/     A4B : 5A                             STR     RA
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 38 - 09/30/24 17:27:32


    1915/     A4C : EA                             SEX     RA
    1916/     A4D : 64                             OUT     4
    1917/     A4E : FC FF                          ADI     0FFh
    1918/     A50 : 88                             GLO     R8
    1919/     A51 : 7E                             SHLC
    1920/     A52 : A8                             PLO     R8
    1921/     A53 : FA 03                          ANI     003h
    1922/     A55 : 3A 38                          BNZ     Z290
    1923/     A57 : 19                             INC     R9
    1924/     A58 : 8A                             GLO     RA
    1925/     A59 : (MACRO)             Z292       RETURN
    1925/     A59 : D5                          SEP R5
    1926/     A5A :                     
    1927/     A5A : 9E                  INPUTR     GHI     RE         ;INPUT FROM KEYBOARD ROUTINE
    1928/     A5B : 32 B0                          BZ      KEYIN
    1929/     A5D : (MACRO)             Z293       SERIAL_B      Z293       ;SERIAL INPUT ROUTINE
    1929/     A5D : 37 5D                               B4 Z293
    1930/     A5F : F6                             SHR
    1931/     A60 : (MACRO)                        CALL    Z158
    1931/     A60 : D4                          SEP R4
    1931/     A61 : 00 F9                       dw Z158
    1932/     A63 : (MACRO)                        SERIAL_B      INPUTR
    1932/     A63 : 37 5A                               B4 INPUTR
    1933/     A65 : F8 7F                          LDI     07Fh
    1934/     A67 : AF                  Z298       PLO     RF
    1935/     A68 : 9E                             GHI     RE
    1936/     A69 : F6                             SHR
    1937/     A6A : (MACRO)                        SERIAL_B      Z294
    1937/     A6A : 37 70                               B4 Z294
    1938/     A6C : 3B 71                          BNF     Z295
    1939/     A6E : 7B                             SEQ
    1940/     A6F : 38                             SKP
    1941/     A70 : 7A                  Z294       REQ
    1942/     A71 : (MACRO)             Z295       CALL    SERIAL_DELAY
    1942/     A71 : D4                          SEP R4
    1942/     A72 : 00 F6                       dw SERIAL_DELAY
    1943/     A74 : 8F                             GLO     RF
    1944/     A75 : F6                             SHR
    1945/     A76 : AF                             PLO     RF
    1946/     A77 : (MACRO)                        SERIAL_BN    Z297
    1946/     A77 : 3F 7B                               BN4 Z297
    1947/     A79 : F9 80                          ORI     080h
    1948/     A7B : 33 67               Z297       BDF     Z298
    1949/     A7D :                     ;           GHI RE
    1950/     A7D :                     ;           SHR
    1951/     A7D :                     ;           SERIAL_B  +       ; Short branch on EF4=1
    1952/     A7D :                     ;           SEQ            ; Set Q=1
    1953/     A7D :                     ;           SKP            ; Skip next byte
    1954/     A7D :                     ;+		   REQ            ; Reset Q=0
    1955/     A7D : 7A                             REQ
    1956/     A7E : (MACRO)                        CALL   SERIAL_DELAY    ; Set P=R4 as program counter
    1956/     A7E : D4                          SEP R4
    1956/     A7F : 00 F6                       dw SERIAL_DELAY
    1957/     A81 : 8F                             GLO RF         ; Get low register RF
    1958/     A82 : (MACRO)                        RETURN
    1958/     A82 : D5                          SEP R5
    1959/     A83 :                     
    1960/     A83 : AC                  OUTPUTR    PLO     RC         ;OUTPUT TO SCREEN ROUTINE
    1961/     A84 : BC                             PHI     RC
    1962/     A85 : 9E                             GHI     RE
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 39 - 09/30/24 17:27:32


    1963/     A86 : 3A 8B                          BNZ     Z299
    1964/     A88 : 8C                             GLO     RC
    1965/     A89 : 30 BA                          BR      DISP
    1966/     A8B : F8 0A               Z299       LDI     00Ah        ;SERIAL OUTPUT ROUTINE
    1967/     A8D : AF                             PLO     RF
    1968/     A8E : (MACRO)                        CALL    SERIAL_DELAY
    1968/     A8E : D4                          SEP R4
    1968/     A8F : 00 F6                       dw SERIAL_DELAY
    1969/     A91 : FC 00                          ADI     0
    1970/     A93 : (MACRO)             Z300       CALL    SERIAL_DELAY
    1970/     A93 : D4                          SEP R4
    1970/     A94 : 00 F6                       dw SERIAL_DELAY
    1971/     A96 : C7                             LSNF
    1972/     A97 : 7A                             REQ
    1973/     A98 : 38                             SKP
    1974/     A99 : 7B                             SEQ
    1975/     A9A : 9C                             GHI     RC
    1976/     A9B : FF 00                          SMI     0
    1977/     A9D : 76                             SHRC
    1978/     A9E : BC                             PHI     RC
    1979/     A9F : 2F                             DEC     RF
    1980/     AA0 : 8F                             GLO     RF
    1981/     AA1 : 3A 93                          BNZ     Z300
    1982/     AA3 : 8C                             GLO     RC
    1983/     AA4 : (MACRO)                        RETURN
    1983/     AA4 : D5                          SEP R5
    1984/     AA5 : (MACRO)             BLINK      FETCH   TIME_+2;   LOOK AT TIMER
    1984/     AA5 : D7                          SEP R7
    1984/     AA6 : 0F                          db (TIME_+2)&255
    1985/     AA7 : FE                             SHL
    1986/     AA8 : FE                             SHL
    1987/     AA9 : FE                             SHL
    1988/     AAA : 3A B3                          BNZ     Z301
    1989/     AAC : 7E                             SHLC               ;EVERY HALF SECOND
    1990/     AAD : (MACRO)                        CALL    TVD        ;TOGGLE CURSOR
    1990/     AAD : D4                          SEP R4
    1990/     AAE : 0A D8                       dw TVD
    1991/     AB0 : (MACRO)             KEYIN      CALL    TVON       ;TURN DISPLAY ON
    1991/     AB0 : D4                          SEP R4
    1991/     AB1 : 09 D8                       dw TVON
    1992/     AB3 : (MACRO)             Z301       KB_BN     BLINK      ;WAIT FOR KEYIN
    1992/     AB3 : 3E A5                               BN3 BLINK
    1993/     AB5 : 9D                             GHI     RD
    1994/     AB6 : (MACRO)                        CALL    TVD        ;TURN CURSOR OFF
    1994/     AB6 : D4                          SEP R4
    1994/     AB7 : 0A D8                       dw TVD
    1995/     AB9 : (MACRO)                        KB_INP             ;GET KEYIN
    1995/     AB9 : 6F                                  INP   7
    1996/     ABA : (MACRO)             DISP       CALL    TVD        ;DISPLAY CHAR
    1996/     ABA : D4                          SEP R4
    1996/     ABB : 0A D8                       dw TVD
    1997/     ABD : AE                             PLO     RE
    1998/     ABE : FB 0A                          XRI     00Ah       ;IF <LF>
    1999/     AC0 : 32 C6                          BZ      HOLD       ;YES
    2000/     AC2 : (MACRO)                        SERIAL_B  HOLD     ;ALSO HOLD ON EF4
    2000/     AC2 : 37 C6                               B4 HOLD
    2001/     AC4 : 8E                             GLO     RE
    2002/     AC5 : (MACRO)                        RETURN
    2002/     AC5 : D5                          SEP R5
    2003/     AC6 : (MACRO)             HOLD       CALL    TVON       ;TURN DISPLAY ON
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 40 - 09/30/24 17:27:32


    2003/     AC6 : D4                          SEP R4
    2003/     AC7 : 09 D8                       dw TVON
    2004/     AC9 : F8 0C               TVOFF      LDI     00Ch       ;TV OFF AND DELAY
    2005/     ACB : BF                             PHI     RF
    2006/     ACC : 2F                  -          DEC     RF
    2007/     ACD : 9F                             GHI     RF
    2008/     ACE : 3A CC                          BNZ     -
    2009/     AD0 : (MACRO)             -          SERIAL_B      -     ;THEN WAIT FOR /4
    2009/     AD0 : 37 D0                               B4 -
    2010/     AD2 : E3                             SEX     R3
    2011/     AD3 : 61                             OUT     1           ;TURN DISPLAY OFF
    2012/     AD4 : 00                             IDL
    2013/     AD5 : 8E                             GLO     RE
    2014/     AD6 : 71                             DIS
    2015/     AD7 : (MACRO)                        RETURN
    2015/     AD7 : D5                          SEP R5
    2016/     AD8 :                     ;
    2017/     AD8 :                     ;       (ORG in last 40 bytes of page)
    2018/     AD8 :                     ;
    2019/     AD8 :                     ; Character Formatter - ASCII character in ACC.
    2020/     AD8 :                     ;
    2021/     AD8 : FA 7F               TVD        ANI     07Fh       ;SET HIGH BIT TO 0
    2022/     ADA : AE                             PLO     RE         ;SAVE FOR EXIT
    2023/     ADB : FF 60                          SMI     060h       ;CHECK FOR UPPER CASE
    2024/     ADD : 8E                             GLO     RE
    2025/     ADE : 3B E3                          BNF     Z304       ;IF NOT JUMP
    2026/     AE0 : FF 20                          SMI     020h       ;CONVERT TO UPPERCASE
    2027/     AE2 : AE                             PLO     RE
    2028/     AE3 : E2                  Z304       SEX     R2
    2029/     AE4 : 8A                             GLO     RA         ;SAVE RA ON STACK
    2030/     AE5 : 73                             STXD
    2031/     AE6 : 9A                             GHI     RA
    2032/     AE7 : 73                             STXD
    2033/     AE8 : 89                             GLO     R9         ;SAVE R9 ON STACK
    2034/     AE9 : 73                             STXD
    2035/     AEA : 99                             GHI     R9
    2036/     AEB : 73                             STXD
    2037/     AEC : 88                             GLO     R8         ;SAVE R8 ON STACK
    2038/     AED : 73                             STXD
    2039/     AEE : 98                             GHI     R8
    2040/     AEF : 73                             STXD
    2041/     AF0 : F8 1E                          LDI     (SHFT)&255       ;SET UP SHIFT PC
    2042/     AF2 : AA                             PLO     RA
    2043/     AF3 : F8 0C                          LDI     (SHFT)>>8
    2044/     AF5 : BA                             PHI     RA
    2045/     AF6 : (MACRO)                        FETCH   TVXY            ;TVXY GET POINTER R8 = *0008-9
    2045/     AF6 : D7                          SEP R7
    2045/     AF7 : 08                          db (TVXY)&255
    2046/     AF8 : B8                             PHI     R8         ;WHICH IS CURSOR
    2047/     AF9 : 4D                             LDA     RD
    2048/     AFA : A8                             PLO     R8
    2049/     AFB : 4D                             LDA     RD         ;D = *000A AND BIT POINTER
    2050/     AFC : FA 07                          ANI     7          ;ONLY WONT LOW 3 BITS
    2051/     AFE : B9                             PHI     R9
    2052/     AFF : (MACRO)                        FETCH   BS         ;BS IS THIS CANCEL
    2052/     AFF : D7                          SEP R7
    2052/     B00 : 13                          db (BS)&255
    2053/     B01 : 8E                             GLO     RE
    2054/     B02 : F3                             XOR                ;AT BS+1=CANCEL
    2055/     B03 : 32 4E                          BZ      DOTON
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 41 - 09/30/24 17:27:32


    2056/     B05 : 8E                             GLO     RE
    2057/     B06 : FF 7F                          SMI     07Fh       ;IGNORE <DEL>=7F
    2058/     B08 : 32 20                          BZ      EXIT2
    2059/     B0A : FC 5F                          ADI     05Fh
    2060/     B0C : 33 A8                          BDF     CHAR       ;IS IT PRINTABLE
    2061/     B0E : FC 13                          ADI     013h
    2062/     B10 : 32 71                          BZ      ODBYTE     ;IS IT <CR>
    2063/     B12 : FC 01                          ADI     1
    2064/     B14 : 32 5F                          BZ      OCBYTE     ;IS IT CLEARSCREEN
    2065/     B16 : FC 02                          ADI     2
    2066/     B18 : 32 55                          BZ      OABYTE     ;IS IF <LF>
    2067/     B1A : FC 09                          ADI     9
    2068/     B1C : 32 4E                          BZ      DOTON      ;1 = TURN DOT ON
    2069/     B1E : 3B 46                          BNF     DOTOFF     ;0 = TURN DOT OFF
    2070/     B20 : (MACRO)             EXIT2      FETCH   01Ah       ;01Ah RD = #001B
    2070/     B20 : D7                          SEP R7
    2070/     B21 : 1A                          db (01AH)&255
    2071/     B22 : 99                             GHI     R9
    2072/     B23 : FA 07                          ANI     7
    2073/     B25 : B9                             PHI     R9
    2074/     B26 : FC FE                          ADI     0FEh
    2075/     B28 : 88                             GLO     R8
    2076/     B29 : 7E                             SHLC
    2077/     B2A : F3                             XOR
    2078/     B2B : FA 07                          ANI     7
    2079/     B2D : F3                             XOR
    2080/     B2E : 5D                             STR     RD
    2081/     B2F : (MACRO)                        FETCH   TVXY+1     ;TVXY+1 RD = #000A
    2081/     B2F : D7                          SEP R7
    2081/     B30 : 09                          db (TVXY+1)&255
    2082/     B31 : 99                             GHI     R9
    2083/     B32 : 73                             STXD               ;STORE BIT POINTER
    2084/     B33 : 88                             GLO     R8
    2085/     B34 : 73                             STXD               ;STORE DISPLAY LOCATION
    2086/     B35 : 98                             GHI     R8
    2087/     B36 : 73                             STXD
    2088/     B37 : 12                             INC     R2         ;RESTORE R8
    2089/     B38 : 42                             LDA     R2
    2090/     B39 : B8                             PHI     R8
    2091/     B3A : 42                             LDA     R2
    2092/     B3B : A8                             PLO     R8
    2093/     B3C : 42                             LDA     R2         ;RESTORE R9
    2094/     B3D : B9                             PHI     R9
    2095/     B3E : 42                             LDA     R2
    2096/     B3F : A9                             PLO     R9
    2097/     B40 : 42                             LDA     R2         ;RESTORE RA
    2098/     B41 : BA                             PHI     RA
    2099/     B42 : 02                             LDN     R2
    2100/     B43 : AA                             PLO     RA
    2101/     B44 : 8E                             GLO     RE         ;GET SAVED CHARACTER
    2102/     B45 : (MACRO)                        RETURN
    2102/     B45 : D5                          SEP R5
    2103/     B46 : F8 80               DOTOFF     LDI     080h       ;POINT TO BIT
    2104/     B48 : DA                             SEP     RA
    2105/     B49 : FB FF                          XRI     0FFh       ;MAKE AND MASK
    2106/     B4B : F2                             AND
    2107/     B4C : 30 52                          BR      DOTON+4
    2108/     B4E : F8 80               DOTON      LDI     080h
    2109/     B50 : DA                             SEP     RA
    2110/     B51 : F1                             OR
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 42 - 09/30/24 17:27:32


    2111/     B52 : 58                             STR     R8
    2112/     B53 : 30 20                          BR      EXIT2
    2113/     B55 : 88                  OABYTE     GLO     R8         ;0A ROUTINE   DOWN LINE
    2114/     B56 : FC 30                          ADI     030h
    2115/     B58 : A8                             PLO     R8
    2116/     B59 : 98                             GHI     R8
    2117/     B5A : 7C 00                          ADCI    0
    2118/     B5C : B8                             PHI     R8
    2119/     B5D : 30 77                          BR      Z306
    2120/     B5F : F8 3F               OCBYTE     LDI     (BUFX-1)&255  ;0C ROUTINE   CLEAR SCREEN
    2121/     B61 : A8                             PLO     R8
    2122/     B62 : F8 0F                          LDI     (BUFX-1)>>8
    2123/     B64 : B8                             PHI     R8
    2124/     B65 : E8                             SEX     R8         ;REPEAT...
    2125/     B66 : 9D                  CLRS       GHI     RD         ;CLEAR BYTE
    2126/     B67 : 73                             STXD               ;DECREMENT POINTER
    2127/     B68 : 88                             GLO     R8
    2128/     B69 : FF B0                          SMI     (BUFF)&255 ;HAS POINTER REACHED
    2129/     B6B : 98                             GHI     R8         ;START OF BUFFER
    2130/     B6C : 7F 0D                          SMBI    (BUFF)>>8
    2131/     B6E : 33 66                          BDF     CLRS       ;...UNTIL DONE
    2132/     B70 : 60                             IRX                ;CONTINUE TO <CR>
    2133/     B71 : 9D                  ODBYTE     GHI     RD         ;0D ROUTINE   CARRAGE RETURN
    2134/     B72 : B9                             PHI     R9         ;LEFT END OF LINE
    2135/     B73 : 88                             GLO     R8
    2136/     B74 : FA F8                          ANI     0F8h       ;OF BYTE * 8
    2137/     B76 : A8                             PLO     R8
    2138/     B77 : 88                  Z306       GLO     R8         ;CHEAK FOR BOTTOM OF SCREEN
    2139/     B78 : FF 08                          SMI     (BUFE)&255
    2140/     B7A : 98                             GHI     R8
    2141/     B7B : 7F 0F                          SMBI    (BUFE)>>8
    2142/     B7D : 3B 20                          BNF     EXIT2
    2143/     B7F : F8 B0                          LDI     (BUFF)&255
    2144/     B81 : AF                             PLO     RF
    2145/     B82 : 88                             GLO     R8
    2146/     B83 : FC B0                          ADI     (BUFF)&255
    2147/     B85 : FA F8                          ANI     0F8h
    2148/     B87 : AA                             PLO     RA
    2149/     B88 : F8 0D                          LDI     (BUFF)>>8
    2150/     B8A : BF                             PHI     RF
    2151/     B8B : 7C 00                          ADCI    0
    2152/     B8D : BA                             PHI     RA
    2153/     B8E : 4A                  Z308       LDA     RA         ;SCROLL SCREEN
    2154/     B8F : 5F                  Z309       STR     RF
    2155/     B90 : 1F                             INC     RF
    2156/     B91 : 8F                             GLO     RF
    2157/     B92 : FF 08                          SMI     (BUFE)&255
    2158/     B94 : 9F                             GHI     RF
    2159/     B95 : 7F 0F                          SMBI    (BUFE)>>8
    2160/     B97 : 3B 8E                          BNF     Z308
    2161/     B99 : 8F                             GLO     RF
    2162/     B9A : FF 40                          SMI     (BUFX)&255
    2163/     B9C : 9D                             GHI     RD
    2164/     B9D : 3B 8F                          BNF     Z309
    2165/     B9F : 88                             GLO     R8
    2166/     BA0 : FA 07                          ANI     7
    2167/     BA2 : A8                             PLO     R8
    2168/     BA3 : F8 0F                          LDI     (BUFE-8)>>8
    2169/     BA5 : B8                             PHI     R8
    2170/     BA6 : 30 20                          BR      EXIT2
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 43 - 09/30/24 17:27:32


    2171/     BA8 : 8E                  CHAR       GLO     RE         ;20 BYTE - 5A BYTE ROUTINE
    2172/     BA9 : FE                             SHL                ;INDEX INTO CHARACTER TABLE
    2173/     BAA : FC 6F                          ADI     (CTBL-64)&255
    2174/     BAC : AF                             PLO     RF
    2175/     BAD : 9D                             GHI     RD
    2176/     BAE : 7C 0C                          ADCI    (CTBL-64)>>8
    2177/     BB0 : BF                             PHI     RF
    2178/     BB1 : (MACRO)                        FETCH   MASK-1
    2178/     BB1 : D7                          SEP R7
    2178/     BB2 : 0B                          db (MASK-1)&255
    2179/     BB3 : 4F                             LDA     RF         ;GET BIT MASK
    2180/     BB4 : 5D                             STR     RD         ;SAVE IT
    2181/     BB5 : 4F                             LDA     RF
    2182/     BB6 : FC 2F                          ADI     (DOTS)&255
    2183/     BB8 : AF                             PLO     RF         ;POINT TO DOT MATRIX
    2184/     BB9 : 9D                             GHI     RD
    2185/     BBA : 7C 0D                          ADCI    (DOTS)>>8
    2186/     BBC : BF                             PHI     RF
    2187/     BBD : 99                             GHI     R9         ;SAVE CURSOR POSITION
    2188/     BBE : 52                             STR     R2
    2189/     BBF : 22                             DEC     R2
    2190/     BC0 : 0D                             LDN     RD         ;POSITION BIT MASK
    2191/     BC1 : FA 07                          ANI     7
    2192/     BC3 : B9                             PHI     R9
    2193/     BC4 : 0D                             LDN     RD
    2194/     BC5 : FA F8                          ANI     0F8h       ;IT IS LEFT 5 BITS
    2195/     BC7 : DA                             SEP     RA
    2196/     BC8 : 1A                             INC     RA         ;CANCEL 2ND CO-CALL
    2197/     BC9 : 1A                             INC     RA
    2198/     BCA : A9                             PLO     R9         ;SAVE MASK
    2199/     BCB : 12                             INC     R2
    2200/     BCC : E2                             SEX     R2         ;PREPARE TO FIND RELATIVE SHIFT
    2201/     BCD : 0D                             LDN     RD
    2202/     BCE : FA 07                          ANI     7
    2203/     BD0 : F5                             SD                 ;(X=2)
    2204/     BD1 : B9                             PHI     R9
    2205/     BD2 : 89                             GLO     R9         ;SAVE NEW MASK
    2206/     BD3 : 5D                             STR     RD
    2207/     BD4 : 4F                  CHRL       LDA     RF         ;GET SOME DOTS
    2208/     BD5 : ED                             SEX     RD
    2209/     BD6 : F2                             AND                ;MASK INTO THIS CHARACTER
    2210/     BD7 : DA                             SEP     RA         ;SHIFT IT
    2211/     BD8 : F1                             OR                 ;INSERT INTO BUFFER
    2212/     BD9 : 58                             STR     R8
    2213/     BDA : DA                             SEP     RA         ;UP TO NEXT LINE
    2214/     BDB : 33 D4                          BDF     CHRL
    2215/     BDD : 0D                             LDN     RD         ;CHECK FOR SPLIT WORD
    2216/     BDE : DA                             SEP     RA
    2217/     BDF : 1A                             INC     RA         ;DON'T WANT COUNTER
    2218/     BE0 : 1A                             INC     RA
    2219/     BE1 : 3B FC                          BNF     Z310       ;NOT SPLIT
    2220/     BE3 : 8F                             GLO     RF         ;BACK UP DOT POINTER
    2221/     BE4 : FF 06                          SMI     6
    2222/     BE6 : AF                             PLO     RF
    2223/     BE7 : 18                             INC     R8         ;POINT TO NEXT WORD
    2224/     BE8 : 88                             GLO     R8
    2225/     BE9 : FA 07                          ANI     7
    2226/     BEB : 3A F6                          BNZ     Z311
    2227/     BED : 99                             GHI     R9         ;OOPS,NEXT LINE
    2228/     BEE : FA 87                          ANI     087h
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 44 - 09/30/24 17:27:32


    2229/     BF0 : F9 50                          ORI     050h
    2230/     BF2 : B9                             PHI     R9
    2231/     BF3 : 2A                             DEC     RA
    2232/     BF4 : 2A                             DEC     RA
    2233/     BF5 : DA                             SEP     RA
    2234/     BF6 : 99                  Z311       GHI     R9         ;CONVERT TO LEFT SHIFT
    2235/     BF7 : F9 F8                          ORI     0F8h
    2236/     BF9 : B9                             PHI     R9
    2237/     BFA : 30 D4                          BR     CHRL       ;GO DO IT AGAIN
    2238/     BFC : E2                  Z310       SEX     R2
    2239/     BFD : F9 80                          ORI     080h
    2240/     BFF : 38                             SKP                ;FIND RIGHT EDGE
    2241/     C00 : 19                  Z312       INC     R9
    2242/     C01 : F6                             SHR
    2243/     C02 : 3B 00                          BNF     Z312       ;OF MASK
    2244/     C04 : 89                             GLO     R9
    2245/     C05 : FD 09                          SDI     9          ;ANY LEFT?
    2246/     C07 : B9                             PHI     R9
    2247/     C08 : FF 08                          SMI     8
    2248/     C0A : 3B 19                          BNF     CSTK       ;YES
    2249/     C0C : B9                             PHI     R9         ;NO, ADVANCE WORD
    2250/     C0D : 18                             INC     R8
    2251/     C0E : 88                             GLO     R8
    2252/     C0F : FA 07                          ANI     7
    2253/     C11 : 3A 19                          BNZ     CSTK
    2254/     C13 : F8 50                          LDI     050h
    2255/     C15 : B9                             PHI     R9
    2256/     C16 : 2A                             DEC     RA
    2257/     C17 : 2A                             DEC     RA
    2258/     C18 : DA                             SEP     RA
    2259/     C19 : C4                  CSTK       NOP
    2260/     C1A : C0 0B 77                       LBR     Z306
    2261/     C1D : D3                  Z324       SEP     R3         ;< EXIT
    2262/     C1E : 52                  SHFT       STR     R2         ;>ENTER SAVE BITS TO SHIFT
    2263/     C1F : 88                             GLO     R8         ;NOTE IF ADDRESS IS OUTSIDE DISPLAY
    2264/     C20 : FF B0                          SMI     (BUFF)&255
    2265/     C22 : 98                             GHI     R8         ;ONLY WORRY ABOUT TOO LOW
    2266/     C23 : 7F 0D                          SMBI    (BUFF)>>8
    2267/     C25 : 9D                             GHI     RD         ;IF SO, RETURN 0
    2268/     C26 : 3B 47                          BNF     Z314       ;SO PROGRAM ISN'T DESTROYED
    2269/     C28 : 99                             GHI     R9         ;LOOK AT COUNTER
    2270/     C29 : FA 87                          ANI     087h       ;MASK OUT WORD COUNTER
    2271/     C2B : A9                             PLO     R9
    2272/     C2C : 32 45                          BZ      Z315       ;NO SHIFT
    2273/     C2E : FE                             SHL
    2274/     C2F : 33 3A                          BDF     Z316       ;LEFT
    2275/     C31 : 02                  Z317       LDN     R2         ;SHIFT RIGHT ONCE
    2276/     C32 : F6                             SHR
    2277/     C33 : 52                             STR     R2
    2278/     C34 : 29                             DEC     R9
    2279/     C35 : 89                             GLO     R9
    2280/     C36 : 3A 31                          BNZ     Z317       ;REPEAT N TIMES
    2281/     C38 : 30 46                          BR      Z318       ;DONE
    2282/     C3A : F6                  Z316       SHR                ;LEFT SHIFT
    2283/     C3B : FD 08                          SDI     008h       ;SET UP COUNTER
    2284/     C3D : A9                             PLO     R9
    2285/     C3E : 02                  Z319       LDN     R2         ;DO IT
    2286/     C3F : FE                             SHL
    2287/     C40 : 52                             STR     R2
    2288/     C41 : 29                             DEC     R9
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 45 - 09/30/24 17:27:32


    2289/     C42 : 89                             GLO     R9
    2290/     C43 : 3A 3E                          BNZ     Z319       ;REPEAT
    2291/     C45 : FE                  Z315       SHL                ;CLEAR CARRY
    2292/     C46 : 02                  Z318       LDN     R2         ;GET BITS
    2293/     C47 : E8                  Z314       SEX     R8
    2294/     C48 : D3                             SEP     R3         ;EXIT, C=SHIFT OFF RIGHT
    2295/     C49 : 30 4D                          BR      Z320       ;SECOND ENTRY POINT
    2296/     C4B : 30 1E                          BR      SHFT       ;OPTIONAL RERUNS
    2297/     C4D :                     ;
    2298/     C4D :                     ; Count words, moving pointer up
    2299/     C4D :                     ;
    2300/     C4D : 99                  Z320       GHI     R9
    2301/     C4E : FC 18                          ADI     018h       ;CONVERT IF NEGATIVE, ADD 1
    2302/     C50 : 3B 54                          BNF     Z321
    2303/     C52 : F9 80                          ORI     080h       ;(RESTORE SIGN)
    2304/     C54 : FA F7               Z321       ANI     0F7h
    2305/     C56 : B9                             PHI     R9
    2306/     C57 : FE                             SHL                ;SIGN IN C
    2307/     C58 : FA E0                          ANI     0E0h       ;IS THIS END?
    2308/     C5A : FB C0                          XRI     0C0h
    2309/     C5C : 3A 70                          BNZ     Z322       ;NO
    2310/     C5E : 99                             GHI     R9         ;YES, RESTORE ORIGINAL
    2311/     C5F : FA 07                          ANI     7
    2312/     C61 : 3B 65                          BNF     Z323
    2313/     C63 : F9 F8                          ORI     0F8h       ;(NEGATIVE)
    2314/     C65 : B9                  Z323       PHI     R9
    2315/     C66 : 88                             GLO     R8         ;BUMP R8 BACK TO BOTTOM
    2316/     C67 : FC 28                          ADI     028h
    2317/     C69 : A8                             PLO     R8
    2318/     C6A : 98                             GHI     R8
    2319/     C6B : 7C 00                          ADCI    0
    2320/     C6D : B8                             PHI     R8
    2321/     C6E : 30 1D                          BR      Z324       ;C=0
    2322/     C70 : 88                  Z322       GLO     R8         ;GO TO NEXT LINE UP
    2323/     C71 : FF 08                          SMI     8
    2324/     C73 : A8                             PLO     R8
    2325/     C74 : 98                             GHI     R8
    2326/     C75 : 7F 00                          SMBI    0
    2327/     C77 : B8                             PHI     R8
    2328/     C78 : 30 1D                          BR      Z324       ;C=1
    2329/     C7A :                     ;
    2330/     C7A :                     ; Interrupt service routine for 1861
    2331/     C7A :                     ;
    2332/     C7A : F8 03               Z327       LDI     3
    2333/     C7C : A0                             PLO     R0
    2334/     C7D : E2                             SEX     R2
    2335/     C7E : 42                             LDA     R2
    2336/     C7F : FE                             SHL
    2337/     C80 : 42                             LDA     R2         ;RECOVER D
    2338/     C81 : 70                             RET                ;< EXIT
    2339/     C82 : C4                  INTERUPT   NOP                ;> ENTRY DISPLAY INT. ROUTINE
    2340/     C83 : 22                             DEC     R2
    2341/     C84 : 78                             SAV                ;SAVE T
    2342/     C85 : 22                             DEC     R2
    2343/     C86 : 73                             STXD               ;SAVE D
    2344/     C87 : F8 0D                          LDI     (BUFF)>>8
    2345/     C89 : B0                             PHI     R0         ;SET UP R0 FOR DMA
    2346/     C8A : F8 B0                          LDI     (BUFF)&255
    2347/     C8C : A0                             PLO     R0
    2348/     C8D : 34 8D               -          B1      -          ;SYNCHRONIZE
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 46 - 09/30/24 17:27:32


    2349/     C8F : 80                  Z326       GLO     R0
    2350/     C90 : 20                             DEC     R0
    2351/     C91 : A0                             PLO     R0
    2352/     C92 : E0                             SEX     R0         ;NOT A NOP
    2353/     C93 : 20                             DEC     R0
    2354/     C94 : A0                             PLO     R0         ;THREE LINES PER PIXEL
    2355/     C95 : 90                             GHI     R0         ;LAST LINE
    2356/     C96 : FB 0F                          XRI     (BUFE)>>8  ;IS NEW PAGE
    2357/     C98 : 3A 8F                          BNZ     Z326
    2358/     C9A : B0                             PHI     R0
    2359/     C9B : F8 0F                          LDI     (TIME_+2)&255 ;NOW UPDATE CLOCK
    2360/     C9D : A0                             PLO     R0
    2361/     C9E : 76                             SHRC               ;SAVE CARRY
    2362/     C9F : 52                             STR     R2
    2363/     CA0 : F0                             LDX
    2364/     CA1 : FC 01                          ADI     1          ;INCREMENT FRAME COUNT
    2365/     CA3 : 50                             STR     R0
    2366/     CA4 : FF 3D                          SMI     03Dh       ;ONE SECOND
    2367/     CA6 : 3B 7A                          BNF     Z327       ;NOT YET
    2368/     CA8 : 73                             STXD               ;IF YES,
    2369/     CA9 : F0                             LDX                ;BUMP SECONDS
    2370/     CAA : FC 01                          ADI     1
    2371/     CAC : 50                             STR     R0
    2372/     CAD : 30 7A                          BR      Z327
    2373/     CAF : 86 08               CTBL       DW      08608h     ;SP MASK BYTE AND DATA POINTER
    2374/     CB1 : 82 0A                          DW      0820Ah     ;! MASK BYTE AND DATA POINTER
    2375/     CB3 : E5 08                          DW      0E508h     ;" MASK BYTE AND DATA POINTER
    2376/     CB5 : F8 23                          DW      0F823h     ;# MASK BYTE AND DATA POINTER
    2377/     CB7 : E4 35                          DW      0E435h     ;$ MASK BYTE AND DATA POINTER
    2378/     CB9 : E5 5A                          DW      0E55Ah     ;% MASK BYTE AND DATA POINTER
    2379/     CBB : F4 23                          DW      0F423h     ;& MASK BYTE AND DATA POINTER
    2380/     CBD : C2 00                          DW      0C200h     ;' MASK BYTE AND DATA POINTER
    2381/     CBF : C1 11                          DW      0C111h     ;( MASK BYTE AND DATA POINTER
    2382/     CC1 : C2 11                          DW      0C211h     ;) MASK BYTE AND DATA POINTER
    2383/     CC3 : E0 3C                          DW      0E03Ch     ;* MASK BYTE AND DATA POINTER
    2384/     CC5 : E5 47                          DW      0E547h     ;+ MASK BYTE AND DATA POINTER
    2385/     CC7 : C3 07                          DW      0C307h     ;, MASK BYTE AND DATA POINTER
    2386/     CC9 : C4 41                          DW      0C441h     ;- MASK BYTE AND DATA POINTER
    2387/     CCB : 84 07                          DW      08407h     ;. MASK BYTE AND DATA POINTER
    2388/     CCD : E5 29                          DW      0E529h     ;/ MASK BYTE AND DATA POINTER
    2389/     CCF : E1 11                          DW      0E111h     ;0 MASK BYTE AND DATA POINTER
    2390/     CD1 : E2 43                          DW      0E243h     ;1 MASK BYTE AND DATA POINTER
    2391/     CD3 : E4 4F                          DW      0E44Fh     ;2 MASK BYTE AND DATA POINTER
    2392/     CD5 : E1 03                          DW      0E103h     ;3 MASK BYTE AND DATA POINTER
    2393/     CD7 : E0 1D                          DW      0E01Dh     ;4 MASK BYTE AND DATA POINTER
    2394/     CD9 : E0 42                          DW      0E042h     ;5 MASK BYTE AND DATA POINTER
    2395/     CDB : E2 49                          DW      0E249h     ;6 MASK BYTE AND DATA POINTER
    2396/     CDD : E0 73                          DW      0E073h     ;7 MASK BYTE AND DATA POINTER
    2397/     CDF : E3 03                          DW      0E303h     ;8 MASK BYTE AND DATA POINTER
    2398/     CE1 : E0 49                          DW      0E049h     ;9 MASK BYTE AND DATA POINTER
    2399/     CE3 : 83 04                          DW      08304h     ;: MASK BYTE AND DATA POINTER
    2400/     CE5 : C3 35                          DW      0C335h     ;; MASK BYTE AND DATA POINTER
    2401/     CE7 : E5 41                          DW      0E541h     ;< MASK BYTE AND DATA POINTER
    2402/     CE9 : E5 03                          DW      0E503h     ;= MASK BYTE AND DATA POINTER
    2403/     CEB : E5 17                          DW      0E517h     ;> MASK BYTE AND DATA POINTER
    2404/     CED : E0 5A                          DW      0E05Ah     ;? MASK BYTE AND DATA POINTER
    2405/     CEF : E0 79                          DW      0E079h     ;@ MASK BYTE AND DATA POINTER
    2406/     CF1 : E1 2F                          DW      0E12Fh     ;A MASK BYTE AND DATA POINTER
    2407/     CF3 : E5 6D                          DW      0E56Dh     ;B MASK BYTE AND DATA POINTER
    2408/     CF5 : E4 17                          DW      0E417h     ;C MASK BYTE AND DATA POINTER
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 47 - 09/30/24 17:27:32


    2409/     CF7 : E2 17                          DW      0E217h     ;D MASK BYTE AND DATA POINTER
    2410/     CF9 : E5 60                          DW      0E560h     ;E MASK BYTE AND DATA POINTER
    2411/     CFB : E5 34                          DW      0E534h     ;F MASK BYTE AND DATA POINTER
    2412/     CFD : E2 4F                          DW      0E24Fh     ;G MASK BYTE AND DATA POINTER
    2413/     CFF : E3 3B                          DW      0E33Bh     ;H MASK BYTE AND DATA POINTER
    2414/     D01 : 82 17                          DW      08217h     ;I MASK BYTE AND DATA POINTER
    2415/     D03 : E1 55                          DW      0E155h     ;J MASK BYTE AND DATA POINTER
    2416/     D05 : E0 60                          DW      0E060h     ;K MASK BYTE AND DATA POINTER
    2417/     D07 : E3 43                          DW      0E343h     ;L MASK BYTE AND DATA POINTER
    2418/     D09 : F9 6D                          DW      0F96Dh     ;M MASK BYTE AND DATA POINTER
    2419/     D0B : F4 1D                          DW      0F41Dh     ;N MASK BYTE AND DATA POINTER
    2420/     D0D : E0 17                          DW      0E017h     ;O MASK BYTE AND DATA POINTER
    2421/     D0F : E5 73                          DW      0E573h     ;P MASK BYTE AND DATA POINTER
    2422/     D11 : E0 0B                          DW      0E00Bh     ;Q MASK BYTE AND DATA POINTER
    2423/     D13 : E5 3B                          DW      0E53Bh     ;R MASK BYTE AND DATA POINTER
    2424/     D15 : E0 29                          DW      0E029h     ;S MASK BYTE AND DATA POINTER
    2425/     D17 : E0 66                          DW      0E066h     ;T MASK BYTE AND DATA POINTER
    2426/     D19 : E2 1D                          DW      0E21Dh     ;U MASK BYTE AND DATA POINTER
    2427/     D1B : E3 79                          DW      0E379h     ;V MASK BYTE AND DATA POINTER
    2428/     D1D : FB 2E                          DW      0FB2Eh     ;W MASK BYTE AND DATA POINTER
    2429/     D1F : E2 60                          DW      0E260h     ;X MASK BYTE AND DATA POINTER
    2430/     D21 : E2 73                          DW      0E273h     ;Y MASK BYTE AND DATA POINTER
    2431/     D23 : E0 35                          DW      0E035h     ;Z MASK BYTE AND DATA POINTER
    2432/     D25 : C0 17                          DW      0C017h     ;[ MASK BYTE AND DATA POINTER
    2433/     D27 : E3 29                          DW      0E329h     ;\ MASK BYTE AND DATA POINTER
    2434/     D29 : C1 17                          DW      0C117h     ;] MASK BYTE AND DATA POINTER
    2435/     D2B : E2 00                          DW      0E200h     ;^ MASK BYTE AND DATA POINTER
    2436/     D2D : E5 07                          DW      0E507h     ;_ MASK BYTE AND DATA POINTER
    2437/     D2F : 00 00               DOTS       DW      00000h     ;START OF DOT TABLE
    2438/     D31 : 80 80                          DW      08080h
    2439/     D33 : E8 97                          DW      0E897h
    2440/     D35 : A8 97                          DW      0A897h
    2441/     D37 : 68 40                          DW      06840h
    2442/     D39 : 40 20                          DW      04020h
    2443/     D3B : 40 AD                          DW      040ADh
    2444/     D3D : B6 AD                          DW      0B6ADh
    2445/     D3F : 44 04                          DW      04404h
    2446/     D41 : 20 56                          DW      02056h
    2447/     D43 : DD 57                          DW      0DD57h
    2448/     D45 : 20 00                          DW      02000h
    2449/     D47 : F4 AA                          DW      0F4AAh
    2450/     D49 : A9 AA                          DW      0A9AAh
    2451/     D4B : F4 00                          DW      0F400h
    2452/     D4D : 39 E9                          DW      039E9h
    2453/     D4F : AB AD                          DW      0ABADh
    2454/     D51 : 29 00                          DW      02900h
    2455/     D53 : 55 FA                          DW      055FAh
    2456/     D55 : 54 F8                          DW      054F8h
    2457/     D57 : 54 00                          DW      05400h
    2458/     D59 : C0 24                          DW      0C024h
    2459/     D5B : 4A 91                          DW      04A91h
    2460/     D5D : 60 0A                          DW      0600Ah
    2461/     D5F : 55 75                          DW      05575h
    2462/     D61 : 51 51                          DW      05151h
    2463/     D63 : 20 14                          DW      02014h
    2464/     D65 : EC 86                          DW      0EC86h
    2465/     D67 : 4C 27                          DW      04C27h
    2466/     D69 : E4 00                          DW      0E400h
    2467/     D6B : 15 15                          DW      01515h
    2468/     D6D : BE 55                          DW      0BE55h
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 48 - 09/30/24 17:27:32


    2469/     D6F : B6 00                          DW      0B600h
    2470/     D71 : 01 C2                          DW      001C2h
    2471/     D73 : 3C D2                          DW      03CD2h
    2472/     D75 : 91 F0                          DW      091F0h
    2473/     D77 : 10 02                          DW      01002h
    2474/     D79 : 57 2A                          DW      0572Ah
    2475/     D7B : 70 A0                          DW      070A0h
    2476/     D7D : 58 00                          DW      05800h
    2477/     D7F : DE 68                          DW      0DE68h
    2478/     D81 : A4 62                          DW      0A462h
    2479/     D83 : 1C 06                          DW      01C06h
    2480/     D85 : 23 55                          DW      02355h
    2481/     D87 : 15 18                          DW      01518h
    2482/     D89 : 10 51                          DW      01051h
    2483/     D8B : 04 22                          DW      00422h
    2484/     D8D : A1 44                          DW      0A144h
    2485/     D8F : 00 AF                          DW      000AFh
    2486/     D91 : AC D6                          DW      0ACD6h
    2487/     D93 : AC AF                          DW      0ACAFh
    2488/     D95 : 00 42                          DW      00042h
    2489/     D97 : 42 5F                          DW      0425Fh
    2490/     D99 : 52 F9                          DW      052F9h
    2491/     D9B : 10 00                          DW      01000h
    2492/     D9D : 46 45                          DW      04645h
    2493/     D9F : 56 6D                          DW      0566Dh
    2494/     DA1 : 46 00                          DW      04600h
    2495/     DA3 : 94 94                          DW      09494h
    2496/     DA5 : 56 2D                          DW      0562Dh
    2497/     DA7 : EE 00                          DW      0EE00h
    2498/     DA9 : 68 94                          DW      06894h
    2499/     DAB : B4 B4                          DW      0B4B4h
    2500/     DAD : 54 00                          DW      05400h
    2501/     DAF : DF                             SEP     RF
    2502/     DB0 :                     
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 49 - 09/30/24 17:27:32


  Symbol Table (* = unused):
  --------------------------

 AC :                            0A - |  AEPTR :                         1A C |
 AESTK :                         80 C |  AIL :                           1E C |
 APOP :                         2C5 C |  APUSH :                        354 C |
*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
 ATMSG :                        3BD C |  BACK :                         298 C |
 BASIC :                         20 C |  BELL :                         3A9 C |
 BERR :                         54B C | *BIGENDIAN :                      0 - |
 BLINK :                       0AA5 C |  BNEXT :                        588 C |
 BP :                            0B - |  BPOP :                         2C9 C |
 BPUSH :                        359 C | *BRANCHEXT :                      0 - |
 BREAK :                        546 C |  BREAKV :                       10C C |
 BRKTST :                       0EA C |  BS :                            13 C |
 BUFE :                        0F08 - |  BUFF :                        0DB0 - |
 BUFX :                        0F40 - |  CALL_ :                        12A C |
 CALL_S :                       129 C |  CAN :                           14 C |
 CANCL :                        5D7 C | *CASESENSITIVE :                  0 - |
 CEQ :                          48F C |  CHAR :                        0BA8 C |
 CHIN :                         5EC C |  CHRL :                        0BD4 C |
 CLEAR :                        204 C | *CLER :                         813 C |
 CLRS :                        0B66 C |  CLT :                          492 C |
 CMPR :                         46C C |  COLD :                         1B0 C |
 COLDV :                        100 C |  CONST :                        11C C |
*CONSTPI :        3.141592653589793 - |  CONT :                         538 C |
 CRLF :                         3D5 C |  CSTK :                        0C19 C |
 CTBL :                        0CAF C | *DATE :                  "09/30/24" - |
*DFLT :                         8F0 C |  DISP :                        0ABA C |
 DIVL :                         4EA C |  DNEG :                         513 C |
 DOIT :                         242 C |  DOTOFF :                      0B46 C |
 DOTON :                       0B4E C |  DOTS :                        0D2F C |
 DUPS :                         34E C | *END :                          7EC C |
*ENDIL :                        9D5 C |  ERR :                          37F C |
 EXIT :                         3B5 C |  EXIT2 :                       0B20 C |
*EXPR :                         8F5 C | *FALSE :                          0 - |
 FEND :                         612 C |  FETCH_ :                       14B C |
 FIN :                          3B1 C |  FIND :                         5FE C |
*FINDX :                        608 C | *FLG :                          969 C |
 FLINE :                        60D C |  FORCE :                        3CC C |
*FULLPMMU :                       1 - |  GETLN :                        5AA C |
 GLINO :                        698 C |  GOAL :                         565 C |
*GOSB :                         78B C | *GOTO :                         77F C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HMUCH :                        6D9 C |  HOLD :                        0AC6 C |
 HOOK :                         349 C |  HOOP :                         625 C |
 HOP :                          2A0 C | *I1 :                           7C3 C |
 IADD :                         49B C |  IDIV :                         4CB C |
*IF_ :                          7B5 C |  IIL :                          228 C |
*ILFLG :                        9F8 C | *ILINPOUT :                     126 C |
*ILLOAD :                       9FA C | *ILPEEK :                       114 C |
*ILPOKE :                       118 C | *ILSAVE :                       9FD C |
 IMUL :                         4A7 C |  IND :                          367 C |
 INEG :                         50E C | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INP :                          957 C | *INPT :                         7C7 C |
 INPUTR :                      0A5A C | *INSRCMODE :                      0 - |
 INSRT :                        6A2 C | *INSUPMODE :                      0 - |
 INSX :                         74E C |  INTERUPT :                    0C82 C |
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 50 - 09/30/24 17:27:32


 IO :                           751 C |  ISUB :                         498 C |
*JHOP :                         334 C |  JMP :                          27A C |
 KEYIN :                       0AB0 C |  KEYV :                         106 C |
 KLOOP :                        5B2 C |  LEND :                          19 C |
*LET :                          77A C |  LINE :                          30 C |
 LINO :                          28 C |  LIST :                         63C C |
*LISTON :                         1 - | *LIST_ :                        7F2 C |
 LIT1 :                         341 C |  LITN :                         344 C |
 LIX :                          67B C |  LLINE :                        650 C |
 LLOOP :                        667 C | *LO :                           76D C |
*LOAD :                         8C2 C | *MACEXP :                         7 - |
 MAL :                          323 C |  MASK :                          0C C |
 MATCH :                        31F C |  MEND :                          24 C |
*MOMCPU :                      1802 - | *MOMCPUNAME :                "1802" - |
 MONITOR :                    0F000 - |  MORE :                         71E C |
 MULC :                         4C5 C |  MULL :                         4B1 C |
 NEG :                          518 C |  NEGX :                         521 C |
*NESTMAX :                      100 - |  NEW :                          6BA C |
 NEXT :                         22D C |  NHOP :                         31C C |
 NM10 :                         305 C |  NONBL :                        2AA C |
*NONBX :                        2B4 C |  NTAPE :                        5A1 C |
 NUMB :                         2FB C |  NXA :                           1C C |
 NXT :                          529 C |  OABYTE :                      0B55 C |
 OCBYTE :                      0B5F C |  ODBYTE :                      0B71 C |
 OUTPUTR :                     0A83 C | *OUT_ :                         873 C |
*P0 :                           79B C | *P1 :                           79D C |
*P2 :                           79F C | *P3 :                           7A1 C |
*PACKING :                        0 - |  PAD :                           15 C |
*PADDING :                        1 - |  PADS :                         3DF C |
 PAGE :                           0 C |  PC :                             9 - |
 PDIV :                         4E3 C |  PDVL :                         42E C |
 PEEK :                         122 C | *PEEK_ :                        97B C |
 PEND :                         21A C |  PLF :                          3EF C |
*PLOT :                         81A C | *POKE :                         868 C |
 PRN :                          418 C |  PRNA :                         415 C |
 PRNL :                         43E C | *PRNT :                         794 C |
 PRP :                          425 C |  PRS :                          379 C |
 PZ :                            0D - |  QUOTE :                        370 C |
 R0 :                             0 - |  R1 :                             1 - |
 R2 :                             2 - |  R3 :                             3 - |
 R4 :                             4 - |  R5 :                             5 - |
 R6 :                             6 - |  R7 :                             7 - |
 R8 :                             8 - |  R9 :                             9 - |
 RA :                            0A - | *RB :                            0B - |
 RC :                            0C - |  RD :                            0D - |
 RE :                            0E - | *RELAXED :                        0 - |
 RETN :                         2D3 C | *RETN_ :                        7E2 C |
 RETURN_ :                      13C C |  RETURN_S :                     13B C |
 RF :                            0F - | *RND :                          91B C |
 RSBP :                         448 C |  RSTR :                         56D C |
 RTN :                          581 C |  RUN :                          542 C |
*RUN_ :                         80D C |  SAV :                          681 C |
*SAVE :                         885 C |  SCAN :                         1C6 C |
 SEP5 :                         366 C |  SERIAL_DELAY :                 0F6 C |
 SHAL :                         522 C |  SHCL :                         524 C |
 SHFT :                        0C1E C | *SKIP :                         496 C |
*SKIP_ :                        7A5 C |  SP :                            2E C |
 SPARE :                         17 C |  STACK :                         22 C |
 STEST :                        337 C | *STMT :                         773 C |
 STOK :                         5DD C |  STORE :                        2B6 C |
 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 51 - 09/30/24 17:27:32


 STRNG :                        3C5 C |  STRT :                         766 C |
 STUFF :                        730 C |  SVBP :                         44B C |
 SWAP :                         45E C |  TAB :                          403 C |
 TABLE :                        154 C |  TABS :                         40A C |
 TAPE :                         59E C | *TAPEMODE :                      16 C |
 TBEND :                        1B0 C |  TBERR :                        25C C |
 TBR :                          24B C |  TEND :                         2D4 C |
*TERM :                         90C C | *TIME :                  "17:27:32" - |
 TIME_ :                         0D C |  TJMP :                         26A C |
 TOPS :                          26 C | *TRUE :                           1 - |
 TSTN :                         2F0 C |  TSTR :                         3C2 C |
 TSTV :                         2DD C |  TTOK :                         59C C |
 TTOP :                         58B C |  TTYCC :                         1B C |
 TVD :                         0AD8 C | *TVOFF :                       0AC9 C |
 TVON :                         9D8 C |  TVXY :                           8 C |
 TYPER :                        3F4 C |  TYPEV :                        109 C |
*TYX :                          45D C | *USR :                          948 C |
*VERSION :                     142F - |  WARM :                         1ED C |
 WORK :                          2A C |  X :                             0F - |
 XCHG :                         285 C | *XEC :                          770 C |
 XEQ :                           18 C |  XFER :                         560 C |
 XINIT :                        54E C |  XX :                             8 - |
 Z148 :                         0E1 C |  Z149 :                         0BB C |
 Z150 :                         0BF C |  Z151 :                         0C7 C |
 Z152 :                         0D3 C |  Z153 :                         0C4 C |
 Z154 :                         0DE C |  Z156 :                         0F2 C |
 Z157 :                         0FF C |  Z158 :                         0F9 C |
 Z165 :                         0B6 C |  Z283 :                         9E4 C |
 Z284 :                        0A29 C |  Z285 :                        0A06 C |
 Z286 :                        0A14 C |  Z287 :                        0A0C C |
 Z288 :                        0A2F C |  Z289 :                        0A32 C |
 Z290 :                        0A38 C |  Z291 :                        0A3F C |
 Z292 :                        0A59 C |  Z293 :                        0A5D C |
 Z294 :                        0A70 C |  Z295 :                        0A71 C |
 Z297 :                        0A7B C |  Z298 :                        0A67 C |
 Z299 :                        0A8B C |  Z300 :                        0A93 C |
 Z301 :                        0AB3 C |  Z304 :                        0AE3 C |
 Z306 :                        0B77 C |  Z308 :                        0B8E C |
 Z309 :                        0B8F C |  Z310 :                        0BFC C |
 Z311 :                        0BF6 C |  Z312 :                        0C00 C |
 Z314 :                        0C47 C |  Z315 :                        0C45 C |
 Z316 :                        0C3A C |  Z317 :                        0C31 C |
 Z318 :                        0C46 C |  Z319 :                        0C3E C |
 Z320 :                        0C4D C |  Z321 :                        0C54 C |
 Z322 :                        0C70 C |  Z323 :                        0C65 C |
 Z324 :                        0C1D C |  Z326 :                        0C8F C |
 Z327 :                        0C7A C | *Z80SYNTAX :                      0 - |
 __BACK0 :                      9DE C |  __BACK1 :                     0ACC C |
 __BACK2 :                     0AD0 C |  __BACK3 :                     0C8D C |

    331 symbols
     77 unused symbols

 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 52 - 09/30/24 17:27:32


  Defined Macros:
  ---------------

CALL                                  | FETCH                                
KB_B                                  | KB_BN                                
KB_INP                                | LDI0                                 
RETURN                                | SERIAL_B                             
SERIAL_BN                             |

      9 macros

 AS V1.42 Beta [Bld 172] - Source File Tinybasi_121.asm - Page 53 - 09/30/24 17:27:32


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.07 seconds assembly time

   2502 lines source file
   2854 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
